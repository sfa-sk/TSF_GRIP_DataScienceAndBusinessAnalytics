"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['singleValueVisuals.min.js'] || (this.parseTimeMarkers['singleValueVisuals.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('singleValueVisuals.min.js');var powerbi,__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,a=1,i=arguments.length;a<i;a++)for(var r in e=arguments[a])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};!function(r){!function(b){function t(t){this.defaultTitleColor="#333333",this._animatedTextOptions={},this.mainText=jsCommon.CssConstants.createClassAndSelector("mainText"),this.name=t,this.visualConfiguration={maxFontSize:60}}t.prototype.getMetaDataColumn=function(t){if(t&&t.metadata&&t.metadata.columns)for(var e=0,a=t.metadata.columns.length;e<a;e++){var i=t.metadata.columns[e];if(i.isMeasure){this.metaDataColumn=i;break}}},t.prototype.getAdjustedFontHeight=function(t,e,a){var i={fontFamily:null==(i=this._animatedTextOptions.textProperties)?void 0:i.fontFamily,fontWeight:null==(i=this._animatedTextOptions.textProperties)?void 0:i.fontWeight,fontStyle:null==(i=this._animatedTextOptions.textProperties)?void 0:i.fontStyle,textDecoration:null==(i=this._animatedTextOptions.textProperties)?void 0:i.textDecoration,text:e};return this.getAdjustedFontHeightCore(i,t,a,0)},t.prototype.getAdjustedFontHeightCore=function(t,e,a,i){return 10<i?a:(t.fontSize=jsCommon.PixelConverter.toString(a),r.TextMeasurementService.measureSvgTextWidth(t)<e?a:this.getAdjustedFontHeightCore(t,e,.9*a,i+1))},t.prototype.clear=function(){this.svg.select(this.mainText.selector).text("")},t.prototype.doValueTransition=function(t,e,a,i,r,o,s,n){var l,u,g,p,d,h,c,m,f;if(o||t!==e||null==e)return t=t||0,n=n||this.getDefaultDatumTransform(),o=this.svg,u=this.currentViewport,l=u.height,u=u.width,g=this.getSeedFontHeight(u,l),p=this.getTranslateX(u),m=this.getTranslateY(g),d=this.metaDataColumn,s=s||b.valueFormatter.create({format:this.getFormatString(this.dataPointObjects,d),value:e,displayUnitSystemType:a,formatSingleValues:!0,allowFormatBeautification:!0,columnType:d?d.type:void 0}),a=String(t),h=String(e),!_.isEmpty(e)&&"string"==typeof e||(a=s.format(t),h=s.format(e)),o.classed(this.name,!0),c=[n.getDatum(e,h)],o=o.selectAll("text").data(c),c=o.enter().append("text").classed(this.mainText.class,!0).merge(o),o=this.getAdjustedFontHeight(u,h,g),m=this.getTranslateY(o+(l-o)/2),c.text(a).attr("text-anchor",this.getTextAnchor()).attr("font-size",o).attr("transform",b.SVGUtil.translate(p,m)).style("font-style",null==(u=this._animatedTextOptions.textProperties)?void 0:u.fontStyle).style("text-decoration",null==(g=this._animatedTextOptions.textProperties)?void 0:g.textDecoration).style("font-weight",null==(l=this._animatedTextOptions.textProperties)?void 0:l.fontWeight).style("font-family",null==(o=this._animatedTextOptions.textProperties)?void 0:o.fontFamily).style("fill",this.getTextColor()).call(b.tooltipUtils.tooltipUpdate,[a]),null==e||d&&b.AxisHelper.isDateTime(d.type)||"string"==typeof e?c.text(h).call(b.tooltipUtils.tooltipUpdate,[h]):(f=t,c.transition().duration(r).tween("text",function(t){var t=n.getValue(t),e=d3.interpolate(f,t);return function(t){t=e(t);this.textContent=s.format(t)}})),b.SVGUtil.flushAllD3TransitionsIfNeeded(i,c),c},t.prototype.getDefaultDatumTransform=function(){return{getDatum:function(t,e){return{value:t}},getValue:function(t){return t.value}}},Object.defineProperty(t.prototype,"animatedTextOptions",{get:function(){return this._animatedTextOptions},set:function(t){this._animatedTextOptions=t},enumerable:!1,configurable:!0}),t.prototype.getTextColor=function(){var t,e=this.style&&b.ColorHelper.getThemeColor(this.style,"foreground");return(null==(t=this._animatedTextOptions)?void 0:t.titleColor)||e||this.defaultTitleColor},t.prototype.getSeedFontHeight=function(t,e){t=Math.floor(.75*Math.min(t,e)),e=this.visualConfiguration.maxFontSize;return e?Math.min(e,t):t},t.prototype.getTranslateX=function(t){if(this.visualConfiguration)switch(this.visualConfiguration.align){case"left":return 0;case"right":return t}return t/2},t.prototype.getTranslateY=function(t){return t},t.prototype.getTextAnchor=function(){if(this.visualConfiguration)switch(this.visualConfiguration.align){case"left":return"start";case"right":return"end"}return"middle"},t.prototype.getFormatString=function(t,e){return b.valueFormatter.getFormatStringWithDataPointObjects(t,e,b.StandardObjectPropertyIdentifiers.formatString)},b.AnimatedText=t}(r.visuals||(r.visuals={}))}(powerbi=powerbi||{}),function(t){var o,i;function e(t,e){var a=i.call(this,"animatedNumber")||this;return t&&(a.svg=t),e&&(a.animator=e),a}o=t.visuals||(t.visuals={}),i=o.AnimatedText,__extends(e,i),e.prototype.init=function(t){var e=(this.options=t).element;this.svg||(this.svg=d3.select(e.get(0)).append("svg")),this.currentViewport=t.viewport,this.hostServices=t.host,this.style=t.style,this.updateViewportDependantProperties()},e.prototype.updateViewportDependantProperties=function(){var t=this.currentViewport;this.svg.attr("width",t.width).attr("height",t.height)},e.prototype.update=function(t){this.currentViewport=t.viewport;var e=this.dataViews=t.dataViews;e&&e[0]&&(e=e[0],this.updateViewportDependantProperties(),this.getMetaDataColumn(e),e=e&&e.single?e.single.value:0,this.updateInternal(e,t.suppressAnimations,!0,this.formatter))},e.prototype.setFormatter=function(t){this.formatter=t},e.prototype.onDataChanged=function(t){this.update({dataViews:t.dataViews,suppressAnimations:t.suppressAnimations,viewport:this.currentViewport})},e.prototype.onResizing=function(t){this.update({dataViews:this.dataViews,suppressAnimations:!0,viewport:t})},e.prototype.canResizeTo=function(t){return!0},e.prototype.updateInternal=function(t,e,a,i){void 0===a&&(a=!1);var r=this.value,e=o.AnimatorCommon.GetAnimationDuration(this.animator,e);this.doValueTransition(r,t,null,this.options.animation,e,a,i),this.value=t},o.AnimatedNumber=e}(powerbi=powerbi||{}),define("SingleValueVisuals/animatedNumberModule",["require","exports"],function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createAnimatedNumber=void 0,e.createAnimatedNumber=function(){return new powerbi.visuals.AnimatedNumber}}),function(w){var x,i,C,t,P,V,r;function L(t){var e=r.call(this,L.cardClassName)||this;return e.isScrollable=!1,e.displayUnitSystemType=w.DisplayUnitSystemType.WholeUnits,t&&(e.tooltipsEnabled=t.tooltipsEnabled,e.isScrollable=!!t.isScrollable,e.interactivityEnabled=t.interactivityEnabled,t.animator&&(e.animator=t.animator),null!=t.displayUnitSystemType&&(e.displayUnitSystemType=t.displayUnitSystemType),t.cardSmallViewportProperties&&(e.cardSmallViewportProperties=t.cardSmallViewportProperties),e.featureSwitches=t.featureSwitches||{}),e}x=w.visuals||(w.visuals={}),i=w.visuals.builder,C=x.CardUtil.DefaultStyle,t=jsCommon.CssConstants.createClassAndSelector,P=w.visuals.KpiUtil,V=w.visuals.TextUtil,r=x.AnimatedText,__extends(L,r),L.prototype.init=function(t){var a=this,e=(this.animationOptions=t.animation,t.element),e=(this.tooltipsEnabled&&(this.tooltipService=x.createTooltipService(t.host)),this.kpiImage=d3.select(e.get(0)).append("div").classed(L.KPIImage.class,!0),this.svg=d3.select(e.get(0)).append("svg"));this.graphicsContext=e.append("g"),this.currentViewport=t.viewport,this.hostServices=t.host,this.style=t.style,this.updateViewportProperties(),this.isScrollable&&(e.attr("class",L.cardClassName),this.labelContext=e.append("g")),this.interactivityEnabled&&e.attr("tabindex",0).attr("focusable",!0),this.svg.on("contextmenu",function(){var t=d3.event,e={data:[a.selector],position:{x:t.clientX,y:t.clientY}};a.hostServices.onContextMenu(e),t.preventDefault(),t.stopPropagation()})},L.prototype.onDataChanged=function(t){var e,a,i,r,t=t.dataViews[0];t&&(this.getMetaDataColumn(t),t.single&&(e=t.single.value,a=t.single.objects,t.single.column&&(this.selector={metadata:[t.single.column.queryName]})),this.cardFormatSetting=this.getDefaultFormatSettings(this.style),(t=t.metadata)&&(t=t.objects)&&(r=this.cardFormatSetting.labelSettings,(i=t.labels)&&r&&x.DataLabelViewModel.updateLabelSettingsFromLabelsObject(i,r,void 0,this.style),r.precision!==x.DataLabelViewModel.defaultLabelPrecision&&r.precision<0&&(r.precision=0),i=t.categoryLabels,r=this.cardFormatSetting.categoryLabelSetting,i&&r&&x.DataLabelViewModel.updateLabelSettingsFromLabelsObject(i,r,void 0,this.style),this.cardFormatSetting.wordWrap=w.DataViewObjects.getValue(t,x.cardProps.wordWrap.show,this.cardFormatSetting.wordWrap))),this.updateInternal(e,a,!0,!0)},L.prototype.onResizing=function(t){this.currentViewport=t,this.updateViewportProperties(),this.updateInternal(this.value,this.dataPointObjects,!0,!0)},L.prototype.updateViewportProperties=function(){var t=this.currentViewport;this.svg.attr("width",t.width).attr("height",t.height)},L.prototype.setTextProperties=function(t,e){L.cardTextProperties=x.FontProperties.toTextProperties(e,t)},L.prototype.isSmallViewport=function(){return!!(this.cardSmallViewportProperties&&this.currentViewport.width<=this.cardSmallViewportProperties.cardSmallViewportWidth)},L.prototype.getCardPrecision=function(t){return(t=void 0===t?!1:t)?x.DataLabelViewModel.defaultLabelPrecision:this.cardFormatSetting.labelSettings.precision},L.prototype.getCardDisplayUnits=function(t){var e=!this.metaDataColumn||!this.metaDataColumn.type||this.metaDataColumn.type.numeric;return(t=void 0===t?!1:t)||!e?0:this.cardFormatSetting.labelSettings.displayUnits},L.prototype.getAdjustedFontHeight=function(t,e,a){t=r.prototype.getAdjustedFontHeight.call(this,t,e,a);return Math.min(t,C.card.maxFontSize)},L.prototype.clear=function(t){void 0===t&&(t=!1),this.svg.select(L.Value.selector).text(""),t||this.svg.select(L.Label.selector).text(""),r.prototype.clear.call(this)},L.prototype.updateInternal=function(t,e,a,i){void 0===i&&(i=!1);var r=this.value,a=x.AnimatorCommon.GetAnimationDuration(this.animator,a);if(void 0===t)void 0!==r&&this.clear();else{var o=this.metaDataColumn,s=this.cardFormatSetting.labelSettings,n=this.cardFormatSetting.categoryLabelSetting,l=this.isSmallViewport(),u=this.getCardPrecision(l),l=this.getCardDisplayUnits(l),g=0===l,p=this.getFormatString(e,o),l=x.valueFormatter.create({format:p,value:g?t:l,precision:x.DataLabelViewModel.getLabelPrecision(u,p),displayUnitSystemType:g&&u===x.DataLabelViewModel.defaultLabelPrecision?this.displayUnitSystemType:w.DisplayUnitSystemType.WholeUnits,formatSingleValues:g,allowFormatBeautification:!0,columnType:o?o.type:void 0}),p=this.cardFormatSetting,u=s.fontProperties.size.px;this.setTextProperties(t,this.cardFormatSetting.categoryLabelSetting.fontProperties);var d,h,c,m,g=(n.show?w.TextMeasurementService.estimateSvgTextHeight(L.cardTextProperties):0)+C.label.paddingTop,f=this.currentViewport.width,b=this.currentViewport.height,y=this.getTranslateX(f),v=(b-g-u)/2,S=o&&o.displayName,o=P.isKpi(o)&&P.getKpiImageMetadata(o,t,1);if(this.isScrollable){if(!i&&r===t)return;o?(this.graphicsContext.selectAll("text").remove(),this.displayStatusGraphic(o,t,y,v,u)):(c=void 0,c=_.isEmpty(t)||"string"!=typeof t?l.format(t):t,c=[{displayName:S,value:c}],this.kpiImage.selectAll("div").remove(),d=this.getTranslateY(u+v),(h=(c=this.graphicsContext.attr("transform",x.SVGUtil.translate(y,d)).selectAll("text").data(c)).enter().append("text").attr("class",L.Value.class).merge(c)).text(function(t){return t.value}).style("text-anchor",this.getTextAnchor()).styles(x.FontProperties.toSVGStyle(s.fontProperties)),s.preserveWhitespace?h.style("white-space","pre"):h.style("white-space","normal"),p.wordWrap?(m=h.node(),V.wordBreak(m,f,b-g,void 0,!0,s.preserveWhitespace),1<(s=m.childElementCount)&&(m=u,d=this.getTranslateY(m+(v=(b-g-(u*=s))/2)),this.graphicsContext.attr("transform",x.SVGUtil.translate(y,d)))):h.call(x.AxisHelper.LabelLayoutStrategy.clip,f,w.TextMeasurementService.svgEllipsis),this.addTooltip(h),c.exit().remove()),n.show&&S?(m=[S],s=this.getTranslateY(u+g+v),(h=(d=this.labelContext.attr("transform",x.SVGUtil.translate(y,s)).selectAll("text").data(m)).enter().append("text").attr("class",L.Label.class).merge(d)).text(function(t){return t}).styles(x.FontProperties.toSVGStyle(n.fontProperties)).style("text-anchor",this.getTextAnchor()),n.preserveWhitespace?h.style("white-space","pre"):h.style("white-space","normal"),(g=h.node())&&(p.wordWrap?V.wordBreak(g,f,b-s,void 0,!0,n.preserveWhitespace):h.call(x.AxisHelper.LabelLayoutStrategy.clip,f,w.TextMeasurementService.svgEllipsis)),d.exit().remove()):this.labelContext.selectAll("text").remove()}else o?(this.graphicsContext.selectAll("text").remove(),this.displayStatusGraphic(o,t,y,v,u)):(this.kpiImage.selectAll("div").remove(),(c=this.doValueTransition(r,t,this.displayUnitSystemType,this.animationOptions,a,i,l,{getDatum:function(t,e){return{displayName:S,value:e,unformattedValue:t}},getValue:function(t){return t.unformattedValue}})).classed("value",!0),this.addTooltip(c),this.graphicsContext.call(x.tooltipUtils.tooltipUpdate,[t]));this.interactivityEnabled&&(m=void 0,m=(o?this.kpiImage.selectAll("div"):this.graphicsContext.selectAll("text")).datum(),this.svg.attr("aria-label",x.tooltipUtils.formatTooltipInfo([m]))),this.value=t,this.dataPointObjects=e}},L.prototype.displayStatusGraphic=function(t,e,a,i,r){this.graphicsContext.selectAll("text").remove();var o=this.kpiImage.select("div"),t=((o=o&&!o.empty()?o:this.kpiImage.append("div")).attr("class",["value",t.class].join(" ")).style("position","absolute").style("font-size",r+"px"),o.node().offsetWidth),s=o.node().offsetHeight,a=(o.style("transform",x.SVGUtil.translateWithPixels(a-t/2,this.getTranslateY(r+i)-s)),{displayName:this.metaDataColumn&&this.metaDataColumn.displayName,kpiValue:{value:e,metadata:this.metaDataColumn.kpi}});o.datum(a),this.addTooltip(o)},L.prototype.getDefaultFormatSettings=function(e){function t(t){return x.ColorHelper.getThemeColor(e,t)}return{labelSettings:x.DataLabelViewModel.getDefaultLabelSettings({show:!0,labelColor:t(C.value.colorName),fontSize:C.value.textSize,fontFamily:C.value.fontFamily,preserveWhitespace:!0,style:e,textClassName:"callout"}),categoryLabelSetting:x.DataLabelViewModel.getDefaultLabelSettings({show:!0,labelColor:t(C.label.colorName),fontSize:C.label.textSize,fontFamily:C.label.fontFamily,preserveWhitespace:!0,style:e,textClassName:"largeLightLabel"}),wordWrap:!1}},L.prototype.getDataLabelSettingsOptions=function(t,e,a){return{enumeration:t,dataLabelsSettings:e,show:!0,displayUnits:a,precision:a,fontSize:!0,fontFamily:!0,style:this.style,preserveWhitespace:!0,bold:!0,italic:!0,underline:!0}},L.prototype.getDataLabelSettingsOptionsWithWordWrap=function(t,e,a){return e.wordWrap=this.cardFormatSetting.wordWrap,{enumeration:t,dataLabelsSettings:e,show:!0,displayUnits:a,precision:a,fontSize:!0,fontFamily:!0,style:this.style,preserveWhitespace:!0,wordWrap:!0,bold:!0,italic:!0,underline:!0}},L.prototype.enumerateObjectInstances=function(t){this.cardFormatSetting||(this.cardFormatSetting=this.getDefaultFormatSettings(this.style));var e=this.cardFormatSetting,a=e.labelSettings,i=e.categoryLabelSetting,r=new x.ObjectEnumerationBuilder;switch(t.objectName){case"categoryLabels":x.DataLabelViewModel.enumerateCategoryLabels(r,i,!0,this.featureSwitches,void 0,void 0,this.style,this.getExtraLabelConfig(t.objectName));break;case"labels":x.DataLabelViewModel.enumerateDataLabels(this.getDataLabelSettingsOptions(r,a,!0),this.featureSwitches,null,this.getExtraLabelConfig(t.objectName));break;case"wordWrap":r.pushInstance({objectName:"wordWrap",selector:null,properties:{show:e.wordWrap}})}return r.complete()},L.prototype.getFormattingModel=function(){var t=this;return this.cardFormatSetting||(this.cardFormatSetting=this.getDefaultFormatSettings(this.style)),new x.builder.FormattingModelBuilder(function(){return t.getCalloutValueCard()},function(){return t.getCategoryLabelCard()}).build()},L.prototype.getCalloutValueCard=function(){var e=this,t=this.cardFormatSetting.labelSettings,a=__assign(__assign({},x.cardProps.labels),{precision:x.cardProps.labels.labelPrecision,displayUnits:x.cardProps.labels.labelDisplayUnits,wordWrap:x.cardProps.wordWrap.show}),a={cardBuilder:new i.FormattingCardBuilder(new i.FormattingCardUidBuilder("labels"),"Visual_Gauge_CalloutValue",a,function(t){return e.hostServices.getLocalizedString(t)}),dataLabelsProps:a,featureSwitches:this.featureSwitches,hostServices:this.hostServices,options:this.getDataLabelSettingsOptionsWithWordWrap(void 0,t,!0),omitGroupDisplayNames:!0,instanceKind:3};return x.DataLabelViewModel.getDataLabelsFormattingModel(a)},L.prototype.getCategoryLabelCard=function(){var e=this,t=this.cardFormatSetting.categoryLabelSetting,a=x.cardProps.categoryLabels,a=__assign(__assign({},a),{color:__assign(__assign({},a.color),{instanceKind:3})});return x.DataLabelViewModel.getCategoryLabelsCard({cardName:"Visual_CategoryLabel",dataLabelSettings:t,isShowCategory:!1,localize:function(t){return e.hostServices.getLocalizedString(t)},props:a,revertToDefaultProps:x.cardProps.categoryLabels,showBackground:!1,showValueColor:!0,style:this.style,featureSwitches:this.featureSwitches})},L.prototype.getExtraLabelConfig=function(t){return{objectName:t,propertyInstanceKind:{color:3,backgroundColor:3}}},L.prototype.addTooltip=function(t){var e=this,a=this.hostServices.tooltips();this.tooltipsEnabled&&a&&a.enabled()&&this.tooltipService.addTooltip(t,function(t){t=t.data;return t.kpiValue?[{displayName:t.displayName,kpiValue:t.kpiValue}]:[{displayName:t.displayName,value:t.value}]},function(){return e.getTooltipIdentity()&&[e.getTooltipIdentity()]})},L.prototype.getTooltipIdentity=function(){return this.metaDataColumn&&x.SelectionId.createWithMeasure(this.metaDataColumn.queryName)},L.cardClassName="card",L.Label=t("label"),L.Value=t("value"),L.KPIImage=t("caption"),L.cardTextProperties={fontSize:null,text:null,fontFamily:x.DataLabelViewModel.DefaultFontProperties.family},t=L,x.Card=t}(powerbi=powerbi||{}),define("SingleValueVisuals/cardModule",["require","exports"],function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createCard=void 0,e.createCard=function(t){return new powerbi.visuals.Card(t)}}),function(v){var S,l,t,u;function w(t,e){this.lastAngle=-Math.PI/2,t&&(t.gaugeSmallViewPortProperties&&(this.gaugeSmallViewPortProperties=t.gaugeSmallViewPortProperties),this.animator=t.animator,this.tooltipsEnabled=t.tooltipsEnabled,this.behavior=t.behavior,this.featureSwitches=e||{})}S=v.visuals||(v.visuals={}),l=v.visuals.builder,t=jsCommon.CssConstants.createClassAndSelector,u=v.data.DataRoleHelper,w.prototype.getDataLabelsCard=function(){var t=__assign(__assign({},S.gaugeProps.labels),{displayUnits:S.gaugeProps.labels.labelDisplayUnits,precision:S.gaugeProps.labels.labelPrecision}),e=this.data?this.data.minLabel.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style);return this.generateLabelsCard("labels","Visual_DataPointsLabels",t,this.getDataLabelSettingsOptions(void 0,e),void 0)},w.prototype.getTargetLabelCard=function(){var t=__assign(__assign({},S.gaugeProps.target),{displayUnits:S.gaugeProps.target.labelDisplayUnits,precision:S.gaugeProps.target.labelPrecision}),e=this.data&&this.data.target?this.data.target.label.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style);return this.generateLabelsCard("target","Visual_Gauge_Axis_TargetLabel",t,this.getDataLabelSettingsOptions(void 0,e),!0)},w.prototype.getCalloutValueCard=function(){var t=__assign(__assign({},S.gaugeProps.calloutValue),{displayUnits:S.gaugeProps.calloutValue.labelDisplayUnits,precision:S.gaugeProps.calloutValue.labelPrecision}),e=S.ColorHelper.getThemeColor(this.style,S.ForegroundColorName),a=S.Font.Family.lightSecondary.family,e=this.data?this.data.calloutLabel.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style,e,a);return this.generateLabelsCard("calloutValue","Visual_Gauge_CalloutValue",t,this.getDataLabelSettingsOptions(void 0,e),!0)},w.prototype.generateLabelsCard=function(t,e,a,i,r){var o=this,t={cardBuilder:new l.FormattingCardBuilder(new l.FormattingCardUidBuilder(t),e,a,function(t){return o.hostService.getLocalizedString(t)}),dataLabelsProps:a,featureSwitches:this.featureSwitches,hostServices:this.hostService,options:i,omitDescription:r,instanceKind:3};return S.DataLabelViewModel.getDataLabelsFormattingModel(t)},w.prototype.getColorsCard=function(){var e=this,t=this.data?this.data.dataPointSettings:S.GaugeConverter.getDefaultDataPointSettings(this.style),a=__assign({},S.gaugeProps.dataPoint),i=new l.FormattingCardBuilder(new l.FormattingCardUidBuilder("datapoint"),"Visual_Colors",a,function(t){return e.hostService.getLocalizedString(t)}),r={value:t.fillColor},o={value:t.targetColor};return i.addGroup("datapoint",function(t){t.addSimpleSlice(a.fill.propertyName,new l.ColorPickerBuilder({descriptor:__assign(__assign({},a.fill),{instanceKind:3}),value:r}).build()).addSimpleSlice(a.target.propertyName,new l.ColorPickerBuilder({descriptor:__assign(__assign({},a.target),{instanceKind:3}),value:o}).build())}),i.build()},w.prototype.getGaugeAxisCard=function(){var e,t,a,i,r,o,s=this,n=this.dataView;if(n&&n.metadata)return e=__assign({},S.gaugeProps.axis),t=new l.FormattingCardBuilder(new l.FormattingCardUidBuilder("axis"),"Visual_Gauge_Axis",e,function(t){return s.hostService.getLocalizedString(t)}),a=w.getGaugeObjectsProperties(n),i=a.min,r=a.max,o=a.target,t.addGroup("axis",function(t){t.addSimpleSlice(e.min.propertyName,new l.NumUpDownBuilder({descriptor:__assign(__assign({},e.min),{instanceKind:null!=(t=s.featureSwitches)&&t.expressionBasedFormatting?3:1}),value:i,options:{maxValue:null!=r?{type:1,value:r}:void 0}}).build(),function(t){return t.withDisabled(u.hasRoleInDataView(n,S.gaugeRoleNames.minValue))}).addSimpleSlice(e.max.propertyName,new l.NumUpDownBuilder({descriptor:__assign(__assign({},e.max),{instanceKind:null!=(t=s.featureSwitches)&&t.expressionBasedFormatting?3:1}),value:r,options:{minValue:null!=i?{type:0,value:i}:void 0}}).build(),function(t){return t.withDisabled(u.hasRoleInDataView(n,S.gaugeRoleNames.maxValue))}).addSimpleSlice(e.target.propertyName,new l.NumUpDownBuilder({descriptor:__assign(__assign({},e.target),{instanceKind:null!=(t=s.featureSwitches)&&t.expressionBasedFormatting?3:1}),value:o,options:{minValue:null!=i?{type:0,value:i}:void 0,maxValue:null!=r?{type:1,value:r}:void 0}}).build(),function(t){return t.withDisabled(u.hasRoleInDataView(n,S.gaugeRoleNames.targetValue))})}),t.build()},w.prototype.getFormattingModel=function(){var t=this;return new S.builder.FormattingModelBuilder(function(){return t.getGaugeAxisCard()},function(){return t.getColorsCard()},function(){return t.getDataLabelsCard()},function(){return t.getTargetLabelCard()},function(){return t.getCalloutValueCard()}).build()},w.prototype.enumerateObjectInstances=function(t){var e=new S.ObjectEnumerationBuilder;switch(t.objectName){case"axis":this.enumerateAxis(e);break;case"labels":var a=this.data?this.data.minLabel.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style);S.DataLabelViewModel.enumerateDataLabels(this.getDataLabelSettingsOptions(e,a),this.featureSwitches,null,this.getExtraLabelConfig(t.objectName));break;case"target":var i=this.data&&this.data.target?this.data.target.label.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style);S.DataLabelViewModel.enumerateDataLabels(this.getDataLabelSettingsOptions(e,i),this.featureSwitches,null,this.getExtraLabelConfig(t.objectName));break;case"calloutValue":var i=S.ColorHelper.getThemeColor(this.style,S.ForegroundColorName),r=S.Font.Family.lightSecondary.family,a=this.data?this.data.calloutLabel.settings:S.GaugeConverter.getDefaultGaugeLabelSettings(this.style,i,r);S.DataLabelViewModel.enumerateDataLabels(this.getDataLabelSettingsOptions(e,a),this.featureSwitches,null,this.getExtraLabelConfig(t.objectName));break;case"dataPoint":this.enumerateDataPoint(e)}return e.complete()},w.prototype.getDataLabelSettingsOptions=function(t,e){return{dataLabelsSettings:e,show:!0,precision:!0,displayUnits:!0,fontSize:!0,fontFamily:!0,enumeration:t,style:this.style,bold:!0,italic:!0,underline:!0}},w.prototype.getExtraLabelConfig=function(t){return{objectName:t,propertyInstanceKind:{color:3}}},w.prototype.enumerateAxis=function(t){var e=this.dataView;e&&e.metadata&&(e=w.getGaugeObjectsProperties(e),t.pushInstance({selector:null,objectName:"axis",properties:e,propertyInstanceKind:{min:null!=(t=this.featureSwitches)&&t.expressionBasedFormatting?3:1,max:null!=(e=this.featureSwitches)&&e.expressionBasedFormatting?3:1,target:null!=(t=this.featureSwitches)&&t.expressionBasedFormatting?3:1}}))},w.prototype.enumerateDataPoint=function(t){var e=this.data?this.data.dataPointSettings:S.GaugeConverter.getDefaultDataPointSettings(this.style),a={};a.fill={solid:{color:e.fillColor}},null!=e.targetColor&&(a.target={solid:{color:e.targetColor}}),t.pushInstance({selector:null,objectName:S.gaugeProps.dataPoint.target.objectName,properties:a,propertyInstanceKind:{fill:3,target:3}})},w.getGaugeObjectsProperties=function(t){var e={},a=t.metadata.objects,i=!!a&&!!a.axis;return u.hasRoleInDataView(t,S.gaugeRoleNames.minValue)||(e.min=i?a.axis.min:void 0),u.hasRoleInDataView(t,S.gaugeRoleNames.maxValue)||(e.max=i?a.axis.max:void 0),u.hasRoleInDataView(t,S.gaugeRoleNames.targetValue)||(e.target=i?a.axis.target:void 0),e},w.prototype.init=function(t){this.element=t.element,this.currentViewport=t.viewport,this.style=t.style,this.settings=w.DefaultStyleProperties,this.tooltipService=S.createTooltipService(t.host),this.labelPosition=0,this.margin={top:0,left:0,right:0,bottom:0},this.color=d3.scaleOrdinal([S.ColorHelper.getSentimentColor(this.style,"bad"),S.ColorHelper.getSentimentColor(this.style,"neutral"),S.ColorHelper.getSentimentColor(this.style,"good")]).domain([0,1,2]),this.hostService=t.host,this.behavior&&(this.interactivityService=S.createInteractivityService(this.hostService));var e=this.svg=d3.select(this.element.get(0)).append("svg").classed("gauge",!0),a=(this.interactivityService&&(a=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),e.attr("tabindex",0).attr("focusable",!0).classed(S.SetFocusRingClassName,!a)),this.mainGraphicsContext=e.append("g")),i=(a.attr("class",w.MainGaugeGroupClassName),this.initKpiBands(),this.backgroundArc=d3.arc().innerRadius(0).outerRadius(0).startAngle(-Math.PI/2).endAngle(Math.PI/2)),r=this.foregroundArc=d3.arc().innerRadius(0).outerRadius(0).startAngle(-Math.PI/2),i=(this.backgroundArcPath=a.append("path").classed("backgroundArc",!0).attr("d",i),this.foregroundArcPath=a.append("path").datum({endAngle:-Math.PI/2}).classed("foregroundArc",!0).attr("d",r),this.animatedNumberGraphicsContext=e.append("g")),a=(this.animatedNumber=new S.AnimatedNumber(i),this.animatedNumber.init(t),this.gaugeVisualProperties=this.getGaugeVisualProperties()),r=this.getAnimatedNumberProperties(a.radius,a.innerRadiusFactor,a.top,a.left);this.animatedNumberGraphicsContext.attr("transform",r.transformString),this.animatedNumber.onResizing(r.viewport)},w.prototype.update=function(t){var e,a;this.currentViewport=t.viewport,t.dataViews&&t.dataViews[0]&&(a=this.dataView=t.dataViews[0],e=v.data.createDataViewCategoricalReaderAdvanced(a,{formatStringProp:S.gaugeProps.general.formatString}),(t.type&v.VisualUpdateType.Data||!this.data)&&(this.data=S.GaugeConverter.convert(e,this.style),e=S.getInvalidValueWarnings([a],!1,!1,!1,["Tooltips"]),this.hostService.setWarnings(e)),(t.type&v.VisualUpdateType.Resize||t.type&v.VisualUpdateType.ResizeEnd)&&(t.suppressAnimations=!0),this.dataView.single={value:this.data.calloutLabel.value,column:void 0},this.labels=[this.data.minLabel,this.data.maxLabel],this.showTargetLabel=0<=this.data.target.ratio&&this.data.target.ratio<=1&&150<this.currentViewport.width&&this.showSideNumbersLabelText()&&this.data.target.label.settings.show,a=w.calculatePosition(this.data,this.showTargetLabel,this.currentViewport,this.gaugeSmallViewPortProperties),this.labelPosition=a.labelPosition,this.margin=a.margin,this.gaugeVisualProperties=this.getGaugeVisualProperties(),this.drawViewPort(this.gaugeVisualProperties),this.updateInternal(t.suppressAnimations),this.updateCalloutValue(t.suppressAnimations))},w.prototype.updateCalloutValue=function(t){var e,a,i=this.data.calloutLabel.settings;this.data.calloutLabel.settings.show?(e=this.getAnimatedNumberProperties(this.gaugeVisualProperties.radius,this.gaugeVisualProperties.innerRadiusFactor,this.gaugeVisualProperties.top,this.gaugeVisualProperties.left),a={fontFamily:i.fontProperties.family,fontStyle:i.fontProperties.style,fontWeight:i.fontProperties.weight,textDecoration:i.fontProperties.textDecoration},this.animatedNumberGraphicsContext.attr("transform",e.transformString),this.animatedNumber.animatedTextOptions={textProperties:a,titleColor:i.fontProperties.color},a=this.data.calloutLabel.value,i=this.data.calloutLabel.formatter,this.animatedNumber.setFormatter(i),this.animatedNumber.update({viewport:e.viewport,dataViews:[this.dataView],suppressAnimations:t}),this.animatedNumberGraphicsContext.selectAll("title").remove(),this.animatedNumberGraphicsContext.append("title").text(i.format(a))):(this.animatedNumber.clear(),this.animatedNumberGraphicsContext.selectAll("title").remove())},w.prototype.initKpiBands=function(){if(this.settings.kpiBands.show)for(var t=this.kpiArcs=[],e=this.kpiArcPaths=[],a=this.mainGraphicsContext,i=0;i<3;i++){var r=d3.arc().innerRadius(0).outerRadius(0).startAngle(0).endAngle(0),r=(t.push(r),a.append("path").attr("d",r));e.push(r)}},w.prototype.updateKpiBands=function(t,e,a,i){if(this.settings.kpiBands.show)for(var r=0;r<i.length;r++)this.kpiArcs[r].innerRadius(t*e-(w.KpiBandDistanceFromMainArc+this.settings.kpiBands.thickness)).outerRadius(t*e-w.KpiBandDistanceFromMainArc).startAngle(i[r].start).endAngle(i[r].end),this.kpiArcPaths[r].attr("fill",i[r].fill).attr("d",this.kpiArcs[r]).attr("transform",a)},w.prototype.removeTargetElements=function(){this.targetLine&&(this.targetLine.remove(),this.targetText.remove(),this.targetConnector.remove(),this.targetLine=this.targetConnector=this.targetText=null)},w.prototype.updateTargetLine=function(t,e,a,i){this.targetLine||(this.targetLine=this.mainGraphicsContext.append("line"));var r=this.data.target.ratio*Math.PI,o=i-t*Math.sin(r),t=a-t*Math.cos(r),i=i-e*Math.sin(r),a=a-e*Math.cos(r);this.targetLine.attr("x1",a).attr("y1",i).attr("x2",t).attr("y2",o)},w.prototype.getAnimatedNumberProperties=function(t,e,a,i){var r=Math.PI/4,t=t*e-(this.settings.kpiBands.show?w.KpiBandDistanceFromMainArc+this.settings.kpiBands.thickness:0),e=t*Math.cos(r),t=t*Math.sin(r),r=2*e;return{transformString:S.SVGUtil.translate(i-e,a-t),viewport:{height:t,width:r,scale:1}}},w.prototype.getGaugeVisualProperties=function(){var t=this.currentViewport,e=this.margin,a=t.width-e.right-e.left,i=a/2,t=t.height-e.top-e.bottom,r=Math.min(i,t),o=w.InnerRadiusFactor,i=e.left+i,s=r+(t-r)/2+e.top;return{radius:r,innerRadiusOfArc:r*o,left:i,top:s,height:t,width:a,margin:e,transformString:S.SVGUtil.translate(i,s),innerRadiusFactor:o}},w.prototype.drawViewPort=function(t){var e=this.settings.kpiBands.separationRadians,a=w.InnerRadiusFactor,i=this.backgroundArc,r=this.color,r=[{fill:r(0),start:-Math.PI/2,end:-Math.PI/2+Math.PI/4-e},{fill:r(1),start:-Math.PI/2+ +Math.PI/4+e,end:-Math.PI/2+3*Math.PI/4-e},{fill:r(2),start:-Math.PI/2+3*Math.PI/4+e,end:Math.PI/2}],e=t.radius,o=t.transformString,r=(this.updateKpiBands(e,a,o,r),i.innerRadius(e*a).outerRadius(e).startAngle(-Math.PI/2).endAngle(Math.PI/2),this.backgroundArcPath.attr("d",i).attr("transform",o),this.foregroundArc),i=(r.innerRadius(e*a).outerRadius(e).startAngle(-Math.PI/2),this.foregroundArcPath.datum({endAngle:this.lastAngle}).attr("transform",o).attr("d",r),t.innerRadiusOfArc),a=t.left,o=t.top,r=t.margin,s=t.height;!this.settings.targetLine.show||!$.isNumeric(this.data.target.label.value)||this.data.target.ratio<0||1<this.data.target.ratio?this.removeTargetElements():(this.updateTargetLine(e,i,a,o),this.renderTarget(e,s,t.width,r)),this.svg.attr("height",this.currentViewport.height).attr("width",this.currentViewport.width)},w.prototype.updateInternal=function(t){var e=this.gaugeVisualProperties.height,a=this.gaugeVisualProperties.width,i=this.gaugeVisualProperties.radius,r=this.margin,t=S.AnimatorCommon.GetAnimationDuration(this.animator,t),o=this.data,s=this.lastAngle=-Math.PI/2+Math.PI*this.data.ratio;this.foregroundArcPath.transition().ease(S.D3Helper.easeCompat(this.settings.transition.ease)).duration(t).call(this.arcTween,[s,this.foregroundArc]),this.renderMinMaxLabels(this.labels,i,e,a,r),this.updateVisualConfigurations(),this.tooltipsEnabled&&(this.tooltipService.addTooltip(this.foregroundArcPath,function(t){return o.tooltipInfo},function(t){return o.identity&&[o.identity]}),this.tooltipService.addTooltip(this.backgroundArcPath,function(t){return o.tooltipInfo},function(t){return o.identity&&[o.identity]})),this.interactivityService&&(this.interactivityService.bind([],this.behavior,{paths:[this.foregroundArcPath]}),t=this.hostService.getLocalizedString("Role_DisplayName_MinValue")+" "+o.minLabel.text+". "+this.hostService.getLocalizedString("Role_DisplayName_MaxValue")+" "+o.maxLabel.text+".",this.svg.attr("aria-label",o.formattedTooltip?o.formattedTooltip.concat(" "+t):t)),this.foregroundArcPath.datum().identity=o.identity},w.prototype.updateVisualConfigurations=function(){var t=this.settings,e=this.data.dataPointSettings,a=this.data.strokeSettings;this.mainGraphicsContext.select("line").attr("stroke",e.targetColor).attr("stroke-width",t.targetLine.thickness),a&&a.visible&&this.mainGraphicsContext.select("path").style("stroke",a.color).style("stroke-width",a.width),this.backgroundArcPath.style("fill",S.ColorHelper.getThemeColor(this.style,"backgroundLight")),this.foregroundArcPath.style("fill",e.fillColor)},w.prototype.renderMinMaxLabels=function(t,e,a,i,r){if(this.svg.selectAll(w.LabelText.selector).remove(),this.data.minLabel.settings.show)for(var o=this.data.minLabel.settings,s=t.length,n=s-1,l=this.labelPosition,u=o.fontProperties,g=u.size.px,p=this.settings.labels.padding,d=0;d<s;d++){var h,c,m,f,b=this.gaugeVisualProperties.top,y=S.FontProperties.toTextProperties(u,t[d].text);this.showSideNumbersLabelText()&&(h=r.left+i/2-e*Math.cos(Math.PI*d/n),c=void 0,m=1===d,f=!1,2===l?(f=!0,b+=p,c=m?"end":"start",y.text=v.TextMeasurementService.getTailoredTextOrDefault(y,e)):(c=m?"start":"end",h+=p*(m?1:-1)),b=this.mainGraphicsContext.append("text").attr("x",h).attr("y",b).attr("dy",f?g:0).attr("class",w.LabelText.class).style("text-anchor",c).styles(S.FontProperties.toSVGStyle(u)).text(y.text).append("title").text(y.text),f||this.truncateTextIfNeeded(b,h,m))}},w.prototype.truncateTextIfNeeded=function(t,e,a){a=a?this.currentViewport.width-e:e;t.call(S.AxisHelper.LabelLayoutStrategy.clip,a,v.TextMeasurementService.svgEllipsis)},w.prototype.renderTarget=function(t,e,a,i){var r=this.data.target,o=this.data.target.label.settings,s=r.label.value,r=r.ratio,e=t+(e-t)/2+i.top,n=.5<r,l=this.settings.labels.padding,u=n?"start":"end",g=this.data.target.label.formatter,p=Math.asin(10/t)/Math.PI,p=r<p||1-p<r?n?1-p:p:r,d=i.left+a/2-(t+l)*Math.cos(Math.PI*p),l=e-(t+l)*Math.sin(Math.PI*p);this.targetText||(this.targetText=this.mainGraphicsContext.append("text").classed(w.TargetText.class,!0)),this.targetText.attr("x",d).attr("y",l).style("display",this.showTargetLabel?"":"none").style("text-anchor",u).styles(S.FontProperties.toSVGStyle(o.fontProperties)).text(g.format(s)),this.truncateTextIfNeeded(this.targetText,d,n),this.targetText.call(S.tooltipUtils.tooltipUpdate,[g.format(s)]),this.targetConnector||(this.targetConnector=this.mainGraphicsContext.append("line").classed(w.TargetConnector.class,!0)),r===p?this.targetConnector.style("display","none"):this.targetConnector.attr("x1",i.left+a/2-t*Math.cos(Math.PI*r)).attr("y1",e-t*Math.sin(Math.PI*r)).attr("x2",d).attr("y2",l).style("stroke-width",this.settings.targetLine.thickness).style("stroke",S.ColorHelper.getThemeColor(this.style,"foregroundNeutralSecondary")).style("display","")},w.prototype.arcTween=function(t,i){t.attrTween("d",function(e){var a=d3.interpolate(e.endAngle,i[0]);return function(t){return e.endAngle=a(t),i[1](e)}})},w.calculatePosition=function(t,e,a,i){var r,o,s=w.DefaultStyleProperties,n={margin:{top:0,left:0,bottom:0,right:0},labelPosition:0};if(i&&(i.smallGaugeMarginsOnSmallViewPort&&a.height<i.MinHeightGaugeSideNumbersVisible))return i=i.GaugeMarginsOnSmallViewPort,n.margin={top:i,bottom:i,left:i,right:i},n;return t&&(i=2*s.labels.padding,o=t&&t.minLabel.settings.show,e&&(e=(t.target.ratio<=.5?t.target.ratio:1-t.target.ratio)*Math.PI,r=t.target.label.requiredSpace.width+i,r=(a.width-r)/(Math.cos(e)+1),0<(r=a.width-2*r)&&(t.target.ratio<.5?n.margin.left=r:n.margin.right=r),e=(a.height-t.target.label.requiredSpace.height-i)/Math.sin(e),0<(r=a.height-e)&&(n.margin.top=r)),o&&(e=Math.max(n.margin.left,t.minLabel.requiredSpace.width+i),r=Math.max(n.margin.right,t.maxLabel.requiredSpace.width+i),o=t.minLabel.requiredSpace.height+i,(a.width-e-r)/2<a.height-n.margin.top-o?(n.labelPosition=2,n.margin.bottom=o):(n.labelPosition=1,n.margin={left:e,right:r,top:n.margin.top,bottom:s.labels.padding})),(i=t.strokeSettings)&&i.visible&&(n.margin={left:n.margin.left+i.width,right:n.margin.right+i.width,top:n.margin.top+i.width,bottom:n.margin.bottom+i.width})),n},w.prototype.showSideNumbersLabelText=function(){return!(this.gaugeSmallViewPortProperties&&this.gaugeSmallViewPortProperties.hideGaugeSideNumbersOnSmallViewPort&&this.currentViewport.height<this.gaugeSmallViewPortProperties.MinHeightGaugeSideNumbersVisible)},w.DefaultStyleProperties={transition:{ease:"cubic-in-out"},targetLine:{show:!0,thickness:2},labels:{count:2,padding:5,fontSize:S.DataLabelViewModel.DefaultLabelFontSizeInPt},kpiBands:{show:!1,separationRadians:Math.PI/128,thickness:5}},w.InnerRadiusFactor=.7,w.KpiBandDistanceFromMainArc=2,w.MainGaugeGroupClassName="mainGroup",w.LabelText=t("labelText"),w.TargetConnector=t("targetConnector"),w.TargetText=t("targetText"),t=w,S.Gauge=t}(powerbi=powerbi||{}),function(t){!function(i){function t(){}t.prototype.bindEvents=function(t,e,a){var i=this,t=t.paths;if(!_.isEmpty(t))for(var r=0,o=t;r<o.length;r++){var s=o[r];s&&s.on("contextmenu",function(){return i.handleContextMenu(e)})}},t.prototype.renderSelection=function(t){},t.prototype.handleContextMenu=function(e){var a=i.InteractivityUtils.getPositionOfLastInputEvent(),t=d3.event;t.preventDefault(),i.EventBubblingUtil.markAsHandled(t),i.InteractivityUtils.tryToSelectD3Target(function(t){e.handleContextMenu(t,a)})},i.GaugeBehavior=t}(t.visuals||(t.visuals={}))}(powerbi=powerbi||{}),function(n){!function(p){function s(){}s.getDefaultGaugeLabelSettings=function(t,e,a){e=p.DataLabelViewModel.getDefaultLabelSettings({show:!0,labelColor:e,fontSize:p.DataLabelViewModel.minLabelFontSize,style:t,textClassName:"largeLightLabel"});return a&&(e.fontProperties=p.FontProperties.inherit(e.fontProperties,{family:a})),e.position=null,e.bold=!1,e.italic=!1,e.underline=!1,e},s.getDefaultDataPointSettings=function(t){var e=t.colorPalette.dataColors.getAllColors();return{fillColor:p.ColorHelper.getDataColorByIndex(t,0,p.ForegroundColorName),targetColor:e&&1<e.length?p.ColorHelper.getDataColorByIndex(t,1,p.ForegroundColorName):p.ColorHelper.getThemeColor(t,"foregroundNeutralSecondary")}},s.convert=function(t,e){var a,i=t.columns,r=t.objects.getStaticObjects(),o=i.getValueMetadataColumn(p.gaugeRoleNames.y),t=this.parseGaugeData(t),s=this.convertDataLabelSettings(r,"labels",e,t.minDynamicFormatString),n=this.convertDataLabelSettings(r,"labels",e,t.maxDynamicFormatString),l=this.convertDataLabelSettings(r,"target",e,t.targetDynamicFormatString),u=p.ColorHelper.getThemeColor(e,p.ForegroundColorName),g=p.Font.Family.lightSecondary.family,u=this.convertDataLabelSettings(r,"calloutValue",e,t.valueDynamicFormatString,u,g),g=o&&null!=o.queryName?p.SelectionIdBuilder.builder().withMeasure(o.queryName).createSelectionId():void 0;return e.isHighContrast&&(a={visible:!0,color:p.ColorHelper.getThemeColor(e,p.ForegroundColorName),width:p.CartesianHelper.defaultLineStrokeWidth}),{maxLabel:this.createLabel(t.max,i.getValueMetadataColumn(p.gaugeRoleNames.maxValue),n,o),minLabel:this.createLabel(t.min,i.getValueMetadataColumn(p.gaugeRoleNames.minValue),s,o,t.max),target:{label:this.createLabel(t.target,i.getValueMetadataColumn(p.gaugeRoleNames.targetValue),l,o),ratio:this.getTargetRatio(t)},calloutLabel:this.createLabel(t.value,o,u,o),tooltipInfo:t.tooltipItems,formattedTooltip:p.tooltipUtils.formatTooltipInfo(t.tooltipItems),ratio:this.getValueRatio(t),dataPointSettings:this.convertDataPointSettings(r,e),identity:g,strokeSettings:a}},s.parseGaugeData=function(t){var e,a=t.columns,i=t.objects.getStaticObjects(),r=a.getValueMetadataColumn(p.gaugeRoleNames.y),i=i?i.axis:null,o=t.data.hasValues(p.gaugeRoleNames.y),s=t.data.hasValues(p.gaugeRoleNames.maxValue),n=t.data.hasValues(p.gaugeRoleNames.minValue),l={max:null,min:null,target:null,value:null,tooltipItems:[]};return o&&(l.value=t.data.getValue(p.gaugeRoleNames.y,0),l.valueDynamicFormatString=l.minDynamicFormatString=l.maxDynamicFormatString=t.data.getFormatString(p.gaugeRoleNames.y,0),e=p.converterHelper.formatFromMetadataColumn(l.value,r,p.gaugeProps.general.formatString,!1,l.valueDynamicFormatString),l.tooltipItems.push({displayName:t.data.getValueDisplayName(p.gaugeRoleNames.y),value:e})),t.data.hasValues(p.gaugeRoleNames.targetValue)?(a=a.getValueMetadataColumn(p.gaugeRoleNames.targetValue),l.target=t.data.getValue(p.gaugeRoleNames.targetValue,0),l.targetDynamicFormatString=t.data.getFormatString(p.gaugeRoleNames.targetValue,0),e=p.converterHelper.formatFromMetadataColumn(l.target,a,p.gaugeProps.general.formatString,!1,l.targetDynamicFormatString),l.tooltipItems.push({displayName:t.data.getValueDisplayName(p.gaugeRoleNames.targetValue),value:e})):i&&(l.target=i.target),s?(l.max=t.data.getValue(p.gaugeRoleNames.maxValue,0),l.maxDynamicFormatString=t.data.getFormatString(p.gaugeRoleNames.maxValue,0)):i&&null!=i.max?l.max=i.max:(l.max=1,o&&l.value&&0!==l.value&&(a=!1,(a=r&&null!=(e=p.valueFormatter.getFormatString(r,p.gaugeProps.general.formatString,!0))?p.valueFormatter.getFormatMetadata(e).hasPercent:a)||(l.max=l.value<0?0:2*l.value))),n?(l.min=t.data.getValue(p.gaugeRoleNames.minValue,0),l.minDynamicFormatString=t.data.getFormatString(p.gaugeRoleNames.minValue,0)):i&&null!=i.min?l.min=i.min:(l.min=0,o&&null!=l.value&&l.value<0&&(l.min=2*l.value)),p.TooltipBuilder.addTooltipMeasures(t,l.tooltipItems,0,void 0,p.gaugeProps.general.formatString),l},s.createLabel=function(t,e,a,i,r){var o=a.fontProperties,o=p.FontProperties.toTextProperties(o),e=this.getFormatter(a,e,i,r||t);return o.text=e.format(t),{value:t,requiredSpace:{width:n.TextMeasurementService.measureSvgTextWidth(o),height:n.TextMeasurementService.estimateSvgTextHeight(o)},text:o.text,formatter:e,settings:a}},s.getFormatter=function(t,e,a,i){i=0===t.displayUnits?i:null,e&&e.objects&&!_.isEmpty(n.DataViewObjects.getValue(e.objects,p.gaugeProps.general.formatString))||(e=a),a=t.dynamicFormatString||p.valueFormatter.getFormatString(e,p.gaugeProps.general.formatString),e=p.DataLabelViewModel.getLabelPrecision(t.precision,a),a=p.DataLabelViewModel.getOptionsForLabelFormatter(t,a,i,e);return a.formatSingleValues=!(0<t.displayUnits),0===t.displayUnits&&(a.value=i),p.valueFormatter.create(a)},s.getValueRatio=function(t){if(!_.isNumber(t.value)||!this.isValid(t)||t.value<=t.min)return 0;if(t.value>=t.max)return 1;var e=t.max-t.min;return(t.value-t.min)/e},s.isValid=function(t){return _.isNumber(t.min)&&_.isNumber(t.max)&&t.min<=t.max},s.getTargetRatio=function(t){if(!this.isValid(t)||!_.isNumber(t.target))return-1;var e=t.max-t.min;return 0!=e?(t.target-t.min)/e:0},s.convertDataLabelSettings=function(t,e,a,i,r,o){r=s.getDefaultGaugeLabelSettings(a,r,o);return r.dynamicFormatString=i,t&&(o=t[e],p.DataLabelViewModel.updateLabelSettingsFromLabelsObject(o,r,void 0,a)),r},s.convertDataPointSettings=function(t,e){var a=s.getDefaultDataPointSettings(e),e=p.ColorHelper.create(e);return{fillColor:e.getColorForPropertyWithDefaultColor(t,p.gaugeProps.dataPoint.fill,a.fillColor),targetColor:e.getColorForPropertyWithDefaultColor(t,p.gaugeProps.dataPoint.target,a.targetColor)}},p.GaugeConverter=s}(n.visuals||(n.visuals={}))}(powerbi=powerbi||{}),define("SingleValueVisuals/gaugeModule",["require","exports"],function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.createGauge=void 0,e.createGauge=function(t,e){return new powerbi.visuals.Gauge(t,e)}});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['singleValueVisuals.min.js'] || (this.parseTimeMarkers['singleValueVisuals.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
