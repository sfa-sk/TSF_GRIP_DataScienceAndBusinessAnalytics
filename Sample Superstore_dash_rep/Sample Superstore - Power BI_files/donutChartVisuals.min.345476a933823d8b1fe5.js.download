"use strict";
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['donutChartVisuals.min.js'] || (this.parseTimeMarkers['donutChartVisuals.min.js'] = {});
marker.startEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
if (window.perfTracking && window.perfTracking.startBundleEval) window.perfTracking.startBundleEval('donutChartVisuals.min.js');var es6,powerbi,__spreadArray=this&&this.__spreadArray||function(t,e){for(var a=0,i=e.length,r=t.length;a<i;a++,r++)t[r]=e[a];return t},__extends=this&&this.__extends||function(){var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function a(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();!function(t){var h;function l(t,e,a){var i=Math.sqrt(a.x*a.x+a.y*a.y);if(i<e.innerRadius)return!1;if(i>e.outerRadius)return!1;i=r(a);return!(i<t.startAngle)&&!(i>t.endAngle)}function r(t){var e;if(t)return e=t.x,t=-t.y,e=Math.atan2(e,t),e<0&&(e+=2*Math.PI),e}h=t.visuals||(t.visuals={}),(t=h.DonutLabelUtils||(h.DonutLabelUtils={})).DiagonalLineIndex=0,t.HorizontalLineIndex=1,t.getLabelLeaderLineForDonutChart=function(t,e,a,i,r,n,o){void 0===r&&(r=0),void 0===n&&(n=0);var s,l=.8/.9*1.025,d=(i=(i=void 0===i?0:i)?(i=i,d=e.labelRadius,s=[Math.cos(i)*d,Math.sin(i)*d],[Math.cos(i)*d,Math.sin(i)*d]):(s=e.labelArc.centroid(t),e.labelArc.centroid(t)),null!=o&&o.pieChartMarginBetweenSlices&&(s[0]=s[0]-r,s[1]=s[1]-n,i[0]=i[0]-r,i[1]=i[1]-n),a.x),e=h.DataLabelViewModel.maxLabelOffset/2,t=[d+=d<0?-e:e,a.y];return i[0]*=l,i[1]*=l,[i,s,t]},t.getLabelLeaderLinesSizeForDonutChart=function(t){return t&&2<t.length?[{width:Math.abs(t[1][0]-t[0][0]),height:Math.abs(t[1][1]-t[0][1])},{width:Math.abs(t[2][0]-t[1][0]),height:h.DataLabelRenderer.LineStrokeWidth}]:null},t.getXPositionForDonutLabel=function(t){return t+(t<0?-h.DataLabelViewModel.maxLabelOffset:h.DataLabelViewModel.maxLabelOffset)},t.getSpaceAvailableForDonutLabels=function(t,e){return e.width/2-Math.abs(t)-h.DataLabelViewModel.maxLabelOffset},t.getLabelPosition=function(t,e){var a;return Math.PI,a=e*Math.sin(t-Math.PI/2),{x:e*Math.cos(t-Math.PI/2),y:a}},t.canLabelFit=function(t,e,a){for(var i=a.left,r=a.left+a.width,n=a.top,a=a.top+a.height,o=0,s=[{x:i,y:n},{x:i,y:a},{x:r,y:n},{x:r,y:a}];o<s.length;o++)if(!l(t,e,s[o]))return!1;return!0},t.canPointFit=l,t.getAngleFromPoint=r}(powerbi=powerbi||{}),function(g){var o,t,M=g.visuals||(g.visuals={}),s=g.visuals.builder,e=jsCommon.CssConstants.createClassAndSelector,D=jsCommon.EnumExtensions,a=M.labelStyle,w=M.labelStyle.labelStyleFlagEnum,b=((t=o=o||{}).animationDurationMs=500,t.ease="cubic-in-out",M.donutChartProps={general:{formatString:{objectName:"general",propertyName:"formatString"}},dataPoint:{defaultColor:{objectName:"dataPoint",propertyName:"defaultColor"},fill:{objectName:"dataPoint",propertyName:"fill"}},legend:{show:{objectName:"legend",propertyName:"show"},position:{objectName:"legend",propertyName:"position"},showTitle:{objectName:"legend",propertyName:"showTitle"},titleText:{objectName:"legend",propertyName:"titleText"},labelColor:{objectName:"legend",propertyName:"labelColor"}},slices:{innerRadiusRatio:{objectName:"slices",propertyName:"innerRadiusRatio"},startAngle:{objectName:"slices",propertyName:"startAngle"},borderWidth:{objectName:"slices",propertyName:"borderWidth"},borderColor:{objectName:"slices",propertyName:"borderColor"},explode:{objectName:"slices",propertyName:"explode"}},labels:{position:{objectName:"labels",propertyName:"position"},overflow:{objectName:"labels",propertyName:"overflow"},background:{objectName:"labels",propertyName:"background"}}},e("slice")),v=e("slice-highlight"),c=2*Math.PI,V=(M.DefaultDonutStrokeColorName="foregroundLight",x.getDefaultDonutLabelSettings=function(t){t=x.getDefaultLabelSettings(t);return t.labelStyle=a.category,t.percentagePrecision=M.DataLabelViewModel.defaultPercentageLabelPrecision,t.position=M.donutLabelPosition.outside,t.overflow=!0,t.enableBackgroundWithAuto=M.donutLabelBackground.auto,t.bold=!1,t.italic=!1,t.underline=!1,t},x.converter=function(t,e,a,i,r,n,o,s){var l,t=new d.DonutChartConverter(t,e,a,o=void 0===o?!0:o),a=(t.convert(),t.startAngle*(Math.PI/x.OnePiRadianInDegree)),o=a+2*Math.PI,a=d3.pie().startAngle(a).endAngle(o).sort(null).value(function(t){return t.percentage}),o=(n&&(l=!t.hasCategoryData&&t.hasSeriesData?M.DataPointNavigationStrategy.SeriesOnly:t.hasCategoryData&&t.hasSeriesData?M.DataPointNavigationStrategy.CategoryFirst:M.DataPointNavigationStrategy.CategoryOnly,n.applySelectionStateToData(t.dataPoints),n.applySelectionStateToData(t.legendData.dataPoints)),!r&&i?x.cullDataByViewport(t.dataPoints,t.maxValue,i,e.isHighContrast,t.borderWidth,s):t.dataPoints);return{dataPointsToDeprecate:o,dataPoints:a(o),unCulledDataPoints:t.dataPoints,dataPointsToEnumerate:t.legendData.dataPoints,legendData:t.legendData,hasHighlights:t.hasHighlights,highlightsOverflow:t.highlightsOverflow,dataLabelsSettings:t.dataLabelsSettings,legendObjectProperties:t.legendObjectProperties,maxValue:t.maxValue,visibleGeometryCulled:t.dataPoints.length!==o.length,hasNegativeValues:t.hasNegativeValues,allValuesAreNegative:t.allValuesAreNegative,donutInnerRadiusRatio:t.donutInnerRadiusRatio,startAngle:t.startAngle,navigationStrategy:l,explode:t.explode,borderWidth:t.borderWidth,borderColor:t.borderColor,hasDynamicSeries:t.hasDynamicSeries}},x.prototype.getFirstElement=function(){var t=this.flattenViewModel();if(_.isEmpty(t))return{element:null};var e=t[0].categoryIndex,t=t[0].seriesIndex;return{element:this.findHTMLElement(e,t)}},x.prototype.getNextDataPoint=function(t,e,a){var i=this.flattenViewModel(),i=M.NavigationUtils.getNextFromFlattenedViewModel(i,t,e,this.data.navigationStrategy,a);return{element:this.findHTMLElement(i.categoryIndex,i.seriesIndex)}},x.prototype.findHTMLElement=function(e,a){return this.mainGraphicsContext.selectAll(b.selector).filter(function(t){return t.data.categoryIndex===e&&t.data.seriesIndex===a}).node()},x.prototype.flattenViewModel=function(){return this.data.dataPoints.map(function(t){return{categoryIndex:t.data.categoryIndex,seriesIndex:t.data.seriesIndex}})},x.prototype.init=function(t){this.options=t,this.featureSwitches=t.featureSwitches;var e=t.element,a=(e.empty(),this.parentViewport=t.viewport,this.currentViewport={height:t.viewport.height,width:t.viewport.width},this.style=t.style,this.colors=this.style.colorPalette.dataColors,M.Legend.getDefaultLegendData(this.style));this.data={dataPointsToDeprecate:[],dataPointsToEnumerate:[],dataPoints:[],unCulledDataPoints:[],legendData:a,hasHighlights:!1,highlightsOverflow:!1,dataLabelsSettings:x.getDefaultDonutLabelSettings(this.style),hasDynamicSeries:!1,hasNegativeValues:!1,allValuesAreNegative:!1,donutInnerRadiusRatio:this.isDonutChart?x.DefaultDonutInnerRadiusRatio:0,startAngle:x.DefaultStartAngleDegrees,navigationStrategy:null,explode:x.DefaultExplode,borderWidth:x.DefaultBorderWidth,borderColor:M.DefaultDonutStrokeColorName},this.radius=0,this.maxOffset=0,this.mobileInteractiveLegend=t.interactivity&&t.interactivity.isInteractiveLegend,this.hostService=t.host,this.behavior&&(this.interactivityService=M.createInteractivityService(this.hostService)),this.legend=M.createLegend(e,t.interactivity&&t.interactivity.isInteractiveLegend,this.interactivityService,this.isScrollable,void 0,this.style,this.hostService),this.tooltipService=M.createTooltipService(this.hostService),this.mobileInteractiveLegend&&(a=this.legendContainer=d3.select(e.get(0)).append("div").classed("donutLegend",!0),this.interactivityState={interactiveLegend:new i(this,a,this.colors,t),valueToAngleFactor:0,sliceAngles:[],currentRotate:0,interactiveChosenSliceFinishedSetting:!1,lastChosenInteractiveSliceIndex:0,totalDragAngleDifference:0,currentIndexDrag:0,previousIndexDrag:0,previousDragAngle:0,donutCenter:{x:0,y:0}}),this.svg=d3.select(e.get(0)).append("svg").style("position","absolute").classed("donutChart",!0),this.behavior&&(this.clearCatcher=M.appendClearCatcher(this.svg)),this.mainGraphicsContext=this.svg.append("g"),this.mainGraphicsContext.append("g").classed("slices",!0),this.interactivityService&&(a=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),this.mainGraphicsContext.attr("tabindex",0).attr("focusable",!0).attr("aria-label",this.hostService.getLocalizedString("Visual_Plot")).attr("aria-multiselectable",!0).attr("role","listbox").classed(M.SetFocusRingClassName,!a)),this.labelBackgroundGraphicsContext=this.svg.append("g").classed(M.DataLabelViewModel.labelBackgroundGraphicsContextClass.class,!0),this.labelGraphicsContext=this.svg.append("g").classed(M.DataLabelViewModel.labelGraphicsContextClass.class,!0),this.pie=d3.pie().sort(null).value(function(t){return t.percentage})},x.prototype.update=function(t){var e=t.viewport,e=(this.parentViewport=e,this.dataViews);t.type!==g.VisualUpdateType.Resize&&t.type!==g.VisualUpdateType.ResizeEnd&&(t.dataViews,(e=this.dataViews=t.dataViews)&&0<e.length&&e[0].categorical?this.data=x.converter(e[0],this.style,this.isDonutChart,this.parentViewport,this.disableGeometricCulling,this.interactivityService,this.tooltipsEnabled,this.featureSwitches):this.data={dataPointsToDeprecate:[],dataPointsToEnumerate:[],dataPoints:[],unCulledDataPoints:[],legendData:M.Legend.getDefaultLegendData(this.style),hasHighlights:!1,highlightsOverflow:!1,dataLabelsSettings:x.getDefaultDonutLabelSettings(this.style),hasDynamicSeries:!1,hasNegativeValues:!1,allValuesAreNegative:!1,donutInnerRadiusRatio:this.isDonutChart?x.DefaultDonutInnerRadiusRatio:0,startAngle:x.DefaultStartAngleDegrees,navigationStrategy:null,explode:x.DefaultExplode,borderWidth:x.DefaultBorderWidth,borderColor:M.DefaultDonutStrokeColorName}),this.options.interactivity&&this.options.interactivity.isInteractiveLegend||this.renderLegend(),this.initViewportDependantProperties(),this.initDonutProperties(),this.updateInternal(this.data,t.suppressAnimations),e&&(t=M.getInvalidValueWarnings(e,!1,!1,!1,["Tooltips"]),this.data.allValuesAreNegative?t.push(new M.AllNegativeValuesWarning):this.data.hasNegativeValues&&t.push(new M.NegativeValuesNotSupportedWarning),this.hostService.setWarnings(t))},x.prototype.getLegendCard=function(){var t=this.data.legendData;return M.Legend.getLegendFormattingModel({legendData:t},this.hostService,this.featureSwitches)},x.prototype.getSlicesCard=function(){var e,a,t,i,r=this,n=this.data;if(n)return e=M.donutChartObjectDescriptorProps.slices,a=function(t){return r.hostService.getLocalizedString(t)},t=[M.donutChartObjectDescriptorProps.dataPoint.fill,e.innerRadiusRatio,e.borderColor,e.borderWidth,e.explode],t=new M.builder.FormattingCardBuilder(new M.builder.FormattingCardUidBuilder("slices"),"Role_DisplayName_Slices",t,a),i=M.LegendData.toIEnumerableDataPoints(n.legendData),0<i.length&&t.addGroup("colors",function(t){t.withDisplayName("Visual_Colors");t={groupBuilder:t,dataPoints:i,seriesColorProps:M.donutChartObjectDescriptorProps.dataPoint,localize:a,featureSwitches:r.featureSwitches};g.colorEnumerationHelperModuleFactory().appendSeriesColorSlicesToGroup(t)}),this.featureSwitches.pieChartMarginBetweenSlices?(0!==this.maxOffset&&this.data.explode>this.maxOffset&&(this.data.explode=this.maxOffset),t.addGroup("border",function(t){t.withDisplayName("Visual_Border").addSimpleSlice("borderColor",function(){var t={value:r.data.borderColor};return new s.ColorPickerBuilder({descriptor:e.borderColor,value:t}).build()}).addSimpleSlice("borderWidth",new s.SliderBuilder({descriptor:M.donutChartObjectDescriptorProps.slices.borderWidth,value:r.data.borderWidth,localize:a}).build())}),t.addGroup("spacing",function(t){t.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerRadius",new s.SliderBuilder({descriptor:e.innerRadiusRatio,value:Math.round(100*r.data.donutInnerRadiusRatio/x.OuterRadiusRatio),localize:a,options:{minValue:{type:0,value:0},maxValue:{type:1,value:100},unitSymbol:M.visualLocKeys.PixelUnitSymbol}}).build()).addSimpleSlice("explode",new s.SliderBuilder({descriptor:e.explode,value:r.data.explode,localize:a}).build())})):this.isDonutChart&&t.addGroup("spacing",function(t){t.withDisplayName("RibbonChart_SeriesGapWidth").addSimpleSlice("innerRadius",new s.SliderBuilder({descriptor:e.innerRadiusRatio,value:Math.round(100*r.data.donutInnerRadiusRatio/x.OuterRadiusRatio),localize:a,options:{minValue:{type:0,value:0},maxValue:{type:1,value:100},unitSymbol:M.visualLocKeys.PixelUnitSymbol}}).build())}),t.build()},x.prototype.getDetailLabelsCard=function(){var e=this,t={dataLabelsSettings:this.data&&this.data.dataLabelsSettings?this.data.dataLabelsSettings:x.getDefaultDonutLabelSettings(this.style),show:!0,displayUnits:!0,precision:!0,percentagePrecision:!0,fontSize:!0,fontFamily:!0,labelStyle:!0,style:this.style,bold:!0,italic:!0,underline:!0},a=M.DataLabelViewModel.getDefaultDataLabelsProps("labels");a.position=M.donutChartObjectDescriptorProps.labels.position,a.overflow=M.donutChartObjectDescriptorProps.labels.overflow,a.background=M.donutChartObjectDescriptorProps.labels.background;a={cardBuilder:new s.FormattingCardBuilder(new s.FormattingCardUidBuilder("labels"),"Visual_DetailLabels",a,function(t){return e.hostService.getLocalizedString(t)}),dataLabelsProps:a,featureSwitches:this.featureSwitches,hostServices:this.hostService,options:t,omitDescription:!0,individualSelector:M.DataLabelViewModel.generateLabelIndividualSelector({featureSwitches:this.featureSwitches,hasCategories:null!=_.first(this.data.legendData.dataPoints),hasDynamicSeries:this.data.hasDynamicSeries,hasSeriesSelector:!1})};return M.DataLabelViewModel.getDataLabelsFormattingModel(a)},x.prototype.getRotationCard=function(){var e,t,a=this;if(this.data)return e=function(t){return a.hostService.getLocalizedString(t)},t=new M.builder.FormattingCardBuilder(new M.builder.FormattingCardUidBuilder("rotation"),"Visual_BasicShape_Rotate",[M.donutChartObjectDescriptorProps.slices.startAngle],e),this.featureSwitches.donutChartStartAngle&&t.addGroup("default",function(t){t.addSimpleSlice("rotation",new s.SliderBuilder({descriptor:M.donutChartObjectDescriptorProps.slices.startAngle,value:a.data.startAngle,options:{minValue:{type:0,value:0},maxValue:{type:1,value:360},unitSymbol:M.visualLocKeys.DegreeLocKey},localize:e}).build(),function(t){return t.withCustomDisplayName("Visual_BasicShape_Rotate")})}),t.build()},x.prototype.getFormattingModel=function(){var t=this;if(this.data)return new M.builder.FormattingModelBuilder(function(){return t.getLegendCard()},function(){return t.getSlicesCard()},function(){return t.getDetailLabelsCard()},function(){return t.getRotationCard()}).build()},x.prototype.enumerateObjectInstances=function(t){var e=new M.ObjectEnumerationBuilder,a=this.data&&this.data.dataLabelsSettings?this.data.dataLabelsSettings:x.getDefaultDonutLabelSettings(this.style);switch(t.objectName){case"legend":this.enumerateLegend(e);break;case"dataPoint":this.enumerateDataPoints(e);break;case"slices":this.enumerateSlices(e);break;case"labels":var i={enumeration:e,dataLabelsSettings:a,show:!0,displayUnits:!0,precision:!0,percentagePrecision:!0,fontSize:!0,fontFamily:!0,labelStyle:!0,style:this.style,bold:!0,italic:!0,underline:!0},r=void 0,r={position:a.position};a.position!==M.donutLabelPosition.outside&&(r.overflow=a.overflow,r.background=a.enableBackgroundWithAuto),M.DataLabelViewModel.enumerateDataLabels(i,this.featureSwitches,r)}return e.complete()},x.prototype.enumerateDataPoints=function(t){this.data&&g.colorEnumerationHelperModuleFactory().enumerateSeriesDataColors({enumeration:t,dataPoints:M.LegendData.toIEnumerableDataPoints(this.data.legendData)},this.featureSwitches)},x.prototype.enumerateLegend=function(t){var e;this.data&&(e=this.data.legendData,M.Legend.enumerate({enumeration:t,legendData:e},this.featureSwitches))},x.prototype.enumerateSlices=function(t){if(this.data){if(this.featureSwitches.pieChartMarginBetweenSlices){0!==this.donutProperties.maxOffset&&this.data.explode>this.donutProperties.maxOffset&&(this.data.explode=this.donutProperties.maxOffset);var e={selector:null,validValues:{explode:{numberRange:{min:0,max:this.donutProperties.maxOffset},unitSymbol:g.visuals.visualLocKeys.PercentLocKey}},properties:{innerRadiusRatio:Math.round(100*this.data.donutInnerRadiusRatio/x.OuterRadiusRatio),borderWidth:this.data.borderWidth,borderColor:this.data.borderColor,explode:this.data.explode},objectName:"slices"};this.featureSwitches.donutChartStartAngle&&(e.properties.startAngle=this.data.startAngle)}else{if(!this.isDonutChart&&!this.featureSwitches.donutChartStartAngle)return;e={selector:null,properties:{},objectName:"slices"},this.isDonutChart&&(e.properties.innerRadiusRatio=Math.round(100*this.data.donutInnerRadiusRatio/x.OuterRadiusRatio)),this.featureSwitches.donutChartStartAngle&&(e.properties.startAngle=this.data.startAngle)}t.pushInstance(e)}},x.prototype.setInteractiveChosenSlice=function(t,e){var a,i,r,n=this;0!==this.interactivityState.sliceAngles.length&&(this.interactivityState.lastChosenInteractiveSliceIndex=t,this.interactivityState.interactiveChosenSliceFinishedSetting=!1,a=this.currentViewport,i=t%this.data.dataPoints.length,t=this.interactivityState.sliceAngles[i],(r=this.svg.select("g")).transition().duration(null!=e?e:o.animationDurationMs).ease(M.D3Helper.easeCompat(o.ease)).attr("transform",M.SVGUtil.translateAndRotate(a.width/2,a.height/2,0,0,t)).on("end",function(){n.interactivityState.interactiveChosenSliceFinishedSetting=!0}),this.interactivityState.currentRotate=t,this.interactivityState.interactiveLegend.updateLegend(i),this.svg.selectAll(".slice").attr("opacity",function(t,e){return e===i?1:.6}),M.SVGUtil.flushAllD3TransitionsIfNeeded(this.options,r))},x.prototype.calculateRadius=function(){var t,e=this.currentViewport;return!this.mobileInteractiveLegend&&this.data&&this.data.dataLabelsSettings.show?(t=e.height/e.width,t=2+1/(1+Math.exp(-5*(t-1))),Math.min(e.height,e.width)/t):Math.min(e.height,e.width)/2},x.prototype.getScaleForLegendArrow=function(){var t=1;return t=this.maxHeightToScaleDonutLegend&&this.currentViewport.height<this.maxHeightToScaleDonutLegend?this.currentViewport.height/this.maxHeightToScaleDonutLegend:t},x.prototype.initViewportDependantProperties=function(t){void 0===t&&(t=0),this.currentViewport.height=this.parentViewport.height,this.currentViewport.width=this.parentViewport.width;var e=this.currentViewport,a=(this.mobileInteractiveLegend?e.height-=x.InteractiveLegendContainerHeight:(a=this.legend.getMargins(),e.height-=a.height,e.width-=a.width),this.svg.attr("width",e.width).attr("height",e.height),this.mobileInteractiveLegend?(this.legendContainer.style("width","100%").style("height",x.InteractiveLegendContainerHeight+"px").style("overflow","hidden").style("top",0),this.svg.style("top",x.InteractiveLegendContainerHeight)):M.Legend.positionChartArea(this.svg,this.legend),this.previousRadius=this.radius,this.radius=this.calculateRadius()),i=e.width/2,e=e.height/2;this.outerArc=d3.arc(),this.labelArc=d3.arc().innerRadius(.9*a).outerRadius(.9*a-this.data.explode),this.mobileInteractiveLegend?(this.mainGraphicsContext.attr("transform",M.SVGUtil.translate(i,e)),this.labelGraphicsContext.attr("transform",M.SVGUtil.translate(i,e)),this.labelBackgroundGraphicsContext.attr("transform",M.SVGUtil.translate(i,e))):(this.mainGraphicsContext.transition().duration(t).attr("transform",M.SVGUtil.translate(i,e)),this.labelGraphicsContext.transition().duration(t).attr("transform",M.SVGUtil.translate(i,e)),this.labelBackgroundGraphicsContext.transition().duration(t).attr("transform",M.SVGUtil.translate(i,e))),M.SVGUtil.flushAllD3TransitionsIfNeeded(this.options,this.mainGraphicsContext,this.labelGraphicsContext,this.labelBackgroundGraphicsContext)},x.explodeXOffset=function(t,e){e=e.explode;return Math.sin(t)*e},x.explodeYOffset=function(t,e){e=e.explode;return-Math.cos(t)*e},x.prototype.initDonutProperties=function(){var t,e=.9*this.radius,a=this.radius*x.OuterRadiusRatio-this.data.explode,i=this.radius*this.data.donutInnerRadiusRatio;2*a+5<Math.min(this.currentViewport.height,this.currentViewport.width)&&(t=Math.round(this.radius*x.OuterRadiusRatio-(this.data.explode+1)),t=Math.min(50,Math.max(0,t))),(Math.round(a-i)<x.MinDonutThickness||this.radius*x.OuterRadiusRatio+this.data.explode>e)&&(this.data.explode=0),this.donutProperties={viewport:this.currentViewport,outerArc:this.outerArc.innerRadius(0).outerRadius(i),labelArc:this.labelArc,dataLabelsSettings:this.data.dataLabelsSettings,innerRadius:i,outerRadius:a,labelRadius:e,startAngle:this.data.startAngle,explode:this.data.explode,maxOffset:t}},x.prototype.mergeDatasets=function(t,e){for(var a={},i=0,r=e;i<r.length;i++){var n=r[i],n=(n.identity?n:n.data).identity.getKey();a[n]=null}t=_.filter(t,function(t){return!((t.identity?t:t.data).identity.getKey()in a)}),t=_.map(t,function(t){t=g.Prototype.inherit(t);return void 0===t.percentage?t.data.percentage=0:t.percentage=0,t});return __spreadArray(__spreadArray([],e),t)},x.prototype.updateInternal=function(t,e,a){var i,r,n,o,s,l,d=this.currentViewport;a=(a=void 0===a?0:a)||M.AnimatorCommon.GetAnimationDuration(this.animator,e),this.animator?(i=x.getLayout(this.donutProperties,this.style,this.featureSwitches,t),l=o=void 0,r=[],(n=t.dataLabelsSettings)&&n.show&&(r=this.createLabels()),e||(n={viewModel:t,colors:this.colors,graphicsContext:this.mainGraphicsContext,labelGraphicsContext:this.labelGraphicsContext,labelBackgroundContext:this.labelBackgroundGraphicsContext,interactivityService:this.interactivityService,layout:i,radius:this.radius,donutProperties:this.donutProperties,viewport:d,labels:r,style:this.style},s=(o=this.animator.animate(n)).shapes,l=o.highlightShapes),(e||o.failed)&&(s=x.drawDefaultShapes(this.svg,t,i,this.radius,this.style,this.interactivityService),l=x.drawDefaultHighlightShapes(this.svg,t,i,this.radius,this.style),M.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:this.labelGraphicsContext,dataLabels:r,numeric:!1,backgroundContext:this.labelBackgroundGraphicsContext,twoRows:!0,hasTooltip:!0}),M.DataLabelRenderer.drawLabelLeaderLines(this.labelGraphicsContext,r)),this.assignInteractions(s,l,t),this.tooltipsEnabled&&this.addTooltips(s,l)):this.updateInternalToMove(t,a,this.style),M.SVGUtil.flushAllD3TransitionsIfNeeded(this.options)},x.prototype.createLabels=function(){var t=new g.DonutLabelLayout(this.donutProperties),e=this.createLabelDataPoints();return t.layout(e,this.data.dataLabelsSettings,this.featureSwitches)},x.prototype.createLabelDataPoints=function(){var t=this.data,e=[],a=M.DataLabelViewModel.createColumnFormatterCacheManager(),i=null;0===t.dataLabelsSettings.displayUnits&&(i=d3.max(t.dataPoints,function(t){return Math.abs(t.data.measure)}));for(var r=0;r<this.data.dataPoints.length;r++){var n=this.createLabelDataPoint(t.dataPoints[r],i,a,this.featureSwitches);e.push(n)}return e},x.prototype.createLabelDataPoint=function(t,e,a,i){var r,n,o,s,l,d,h,u,c,g=this.labelArc.centroid(t),p=(t.startAngle+t.endAngle)/2,f=x.explodeXOffset(p,this.donutProperties),p=x.explodeYOffset(p,this.donutProperties),i=null!=i&&i.pieChartMarginBetweenSlices?(y=M.DonutLabelUtils.getXPositionForDonutLabel(g[0])-f,g[1]-p):(y=M.DonutLabelUtils.getXPositionForDonutLabel(g[0]),g[1]),g=this.data.dataLabelsSettings,i={point:{x:y,y:i},validPositions:[y<0?4:8],radius:0},y=M.ColorHelper.getThemeColor(this.style,M.DataLabelViewModel.DefaultLabelColorName),b=M.ColorHelper.getThemeColor(this.style,M.DataLabelViewModel.DefaultInsideLabelColorName),y=null!=(v=null!=(v=t.data.detailLabelFill)?v:y)?v:g.fontProperties.color,b=null!=(v=null!=(v=t.data.insideDetailLabelFill)?v:b)?v:g.fontProperties.color,v=M.DataLabelViewModel.getLabelStyleFlagType(g.labelStyle),m=g.fontProperties,S="",L=this.data.hasHighlights,C=this.data.highlightsOverflow;switch(D.hasFlag(v,M.labelStyle.flagLabelStyleData)&&(h=u=void 0,h=L&&!C?(u=t.data.originalHighlightValue,a.getOrCreate(t.data.highlightFormat,g,e)):(u=t.data.originalMeasure,a.getOrCreate(t.data.measureFormat,g,e)),l=null!=u?h.format(u):null,d=M.DataLabelViewModel.getTextSize(l,m)),D.hasFlag(v,M.labelStyle.flagLabelStyleCategory)&&(r=t.data.label,n=M.DataLabelViewModel.getTextSize(r,m)),D.hasFlag(v,M.labelStyle.flagLabelStylePercent)&&(h=M.valueFormatter.getLocalizedString("Percentage"),u=L&&!C?t.data.highlightPercentage:t.data.percentage,C=(L=_.clone(g)).percentagePrecision,L.displayUnits=0,c=_.isFinite(C)?(C=a.getOrCreate(h,L,null,L.percentagePrecision),null!=u?C.format(u):null):M.valueFormatter.format(u,h),o=M.DataLabelViewModel.getTextSize(c,m)),v){case w.categoryAndDataAndPercent:S=r,l&&(S=M.DataLabelViewModel.combineStrings([S,l]," ")),c&&(S=M.DataLabelViewModel.combineStrings([S,"("+c+")"]," ")),s=M.DataLabelViewModel.getTextSize(S,m);break;case w.categoryAndData:S=r,l&&(S=M.DataLabelViewModel.combineStrings([S,l]," ")),s=M.DataLabelViewModel.getTextSize(S,m);break;case w.categoryAndPercent:S=r,c&&(S=M.DataLabelViewModel.combineStrings([S,c]," ")),s=M.DataLabelViewModel.getTextSize(S,m);break;case w.dataAndPercent:S=l,c&&(S=M.DataLabelViewModel.combineStrings([S,"("+c+")"]," ")),s=M.DataLabelViewModel.getTextSize(S,m);break;case w.data:s=_.clone(d),S=l;break;case w.percent:s=_.clone(o),S=c;break;default:w.category;s=_.clone(n),S=r}a=M.DonutLabelUtils.getLabelLeaderLineForDonutChart(t,this.donutProperties,i.point,0,f,p,this.featureSwitches),L=M.DonutLabelUtils.getLabelLeaderLinesSizeForDonutChart(a);return{isPreferred:!0,text:"",tooltip:S,textSize:s,outsideFill:y,fontProperties:g.fontProperties,identity:t.data.identity,parentShape:i,insideFill:b,parentType:0,alternativeScale:e,donutArcDescriptor:t,angle:(t.endAngle+t.startAngle)/2,dataLabel:l,dataLabelSize:d,categoryLabel:r,categoryLabelSize:n,percentLabel:c,percentLabelSize:o,leaderLinePoints:a,linesSize:L,backgroundColor:g.backgroundColor,backgroundTransparency:g.backgroundTransparency}},x.prototype.renderLegend=function(){var t;this.mobileInteractiveLegend||(this.data.legendObjectProperties?(null!=(t=this.data.legendData).position&&this.legend.setPosition(t.position),this.legend.drawLegend(t,this.parentViewport)):(this.legend.setPosition(M.LegendPosition.Top),this.legend.drawLegend(M.Legend.getDefaultLegendData(this.style),this.parentViewport)))},x.prototype.addInteractiveLegendArrow=function(){var t,e,a;this.data&&this.data.dataPoints&&0!==this.data.dataPoints.length&&(this.interactiveLegendArrow||((a=this.svg.append("g")).append("path").classed("donutLegendArrow",!0).attr("d","M1.5,2.6C0.65,1.15,1.85,0,3,0l27,0c1.65,0,2.35,1.15,1.5,2.6L18,26.45c-0.8,1.45-2.15,1.45-2.95,0L1.95,2.6z"),this.interactiveLegendArrow=a),a=this.currentViewport,t=this.getScaleForLegendArrow(),e=(a.height-2*this.radius)/2+11*t,a=a.width/2-16.5*t,this.interactiveLegendArrow.attr("transform",M.SVGUtil.translateAndScale(a,e,t)))},x.prototype.calculateSliceAngles=function(){var t=[],e=this.data.dataPoints;if(0===e.length)return this.interactivityState.valueToAngleFactor=0,void(this.interactivityState.sliceAngles=[]);for(var a=0,i=0,r=e.length;i<r;i++)a+=e[i].data.percentage;this.interactivityState.valueToAngleFactor=360/a;for(var n=0,i=0,r=e.length;i<r;i++){var o=e[i].data.percentage*this.interactivityState.valueToAngleFactor;n+=o,t.push(o/2-n)}this.interactivityState.sliceAngles=t},x.prototype.assignInteractions=function(t,e,a){var i;this.mobileInteractiveLegend?this.assignInteractiveChartInteractions(t):this.interactivityService&&(i=a.dataPoints.map(function(t){return t.data}),e={root:this.mainGraphicsContext,clearCatcher:this.clearCatcher,slices:t,highlightSlices:e,visual:this,hasHighlights:a.hasHighlights,visualInstanceId:this.hostService.instanceId},t.attr("tabindex",0).attr("focusable",!0),a={navigationStrategy:this.data.navigationStrategy,helper:this},this.interactivityService.bind(i,this.behavior,e,{navigationOptions:a,pointSourceKey:"donut"}))},x.prototype.assignInteractiveChartInteractions=function(t){var a=this,e=this.svg,i=(this.interactivityState.interactiveChosenSliceFinishedSetting=!0,e.node().getBoundingClientRect()),i=(this.interactivityState.donutCenter={x:i.left+i.width/2,y:i.top+i.height/2},this.interactivityState.totalDragAngleDifference=0,this.interactivityState.currentRotate=0,this.calculateSliceAngles(),t.on("click",function(t,e){d3.event.defaultPrevented||a.setInteractiveChosenSlice(e)}),d3.drag().on("start",this.interactiveDragStart).on("drag",this.interactiveDragMove).on("end",this.interactiveDragEnd));e.style("touch-action","none").call(i)},x.prototype.getAngleFromDragEvent=function(){var t=this.interactivityState,e=d3.event.sourceEvent;if(-1!==e.type.toLowerCase().indexOf("touch")){if(1!==e.touches.length)return null;var a=e.touches[0],i=a.pageX,a=a.pageY}else i=e.pageX,a=e.pageY;e={x:i-t.donutCenter.x,y:-a+t.donutCenter.y};return 180*Math.atan2(e.y,e.x)/Math.PI},x.prototype.interactiveDragStart=function(){this.interactivityState.totalDragAngleDifference=0,this.interactivityState.previousDragAngle=this.getAngleFromDragEvent()},x.prototype.interactiveDragMove=function(){var t=this.data.dataPoints,e=this.currentViewport,a=this.interactivityState;if(!0===a.interactiveChosenSliceFinishedSetting){var i=this.getAngleFromDragEvent();if(i){for(var r=a.previousDragAngle-i,n=(a.totalDragAngleDifference+=r,a.previousDragAngle=i,a.currentRotate+=r,this.svg.select("g").attr("transform",M.SVGUtil.translateAndRotate(e.width/2,e.height/2,0,0,this.interactivityState.currentRotate)),t[0].data.percentage*a.valueToAngleFactor),o=a.currentRotate<=0?-1*a.currentRotate%360:360-a.currentRotate%360,s=(a.currentIndexDrag=0,t.length);a.currentIndexDrag<s&&n<o;)a.currentIndexDrag<s-1&&(n+=t[a.currentIndexDrag+1].data.percentage*a.valueToAngleFactor),a.currentIndexDrag++;a.currentIndexDrag!==a.previousIndexDrag&&(a.interactiveLegend.updateLegend(a.currentIndexDrag),this.svg.selectAll(".slice").attr("opacity",function(t,e){return e===a.currentIndexDrag?1:.6}),a.previousIndexDrag=a.currentIndexDrag)}}},x.prototype.interactiveDragEnd=function(){0!==this.interactivityState.totalDragAngleDifference&&(this.setInteractiveChosenSlice(this.interactivityState.currentIndexDrag),d3.event.sourceEvent.stopPropagation())},x.prototype.updateInternalToMove=function(e,t,a){void 0===t&&(t=0);var i,r,n,o=this.svg,s=this.pie,l=this.key,d=this.outerArc,h=this.radius,u=this.previousRadius,c=e.borderColor,g=this.donutProperties,p=this.svg.select(".slices").selectAll("path"+b.selector).data().map(function(t){return t.data}),p=(0===p.length&&(p=e.dataPointsToDeprecate),this.mergeDatasets(p,e.dataPointsToDeprecate)),f=o.select(".slices").selectAll("path"+b.selector).data(s(e.dataPointsToDeprecate),l),y=(f.enter().insert("path").classed(b.class,!0).each(function(t){this._current=t}),f=o.select(".slices").selectAll("path"+b.selector).data(s(p),l),this.donutProperties.innerRadius);x.isSingleColor(e.dataPoints),a.isHighContrast||f.style("stroke-opacity",function(t){return M.ColumnUtil.getFillOpacity(t.data.selected,!1,!1,e.hasHighlights)}).style("stroke-dasharray",function(t){return x.drawStrokeForDonutChart(t,g)}),f.style("fill",function(t){return t.data.color}).style("fill-opacity",function(t){return M.ColumnUtil.getFillOpacity(t.data.selected,!1,!1,e.hasHighlights)}).style("stroke",c).style("stroke-width",function(t){return t.data.strokeWidth}).transition().duration(t).attrTween("d",function(t){var e=d3.interpolate(this._current,t),a=d3.interpolate(u*x.OuterRadiusRatio,h*x.OuterRadiusRatio);return this._current=e(0),function(t){return d.innerRadius(y).outerRadius(a(t))(e(t))}}),(f=o.select(".slices").selectAll("path"+b.selector).data(s(e.dataPointsToDeprecate),l)).exit().transition().delay(t).duration(0).remove(),this.mobileInteractiveLegend||(p=[],(r=e.dataLabelsSettings)&&r.show&&(p=this.createLabels()),M.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:this.labelGraphicsContext,dataLabels:p,numeric:!1,backgroundContext:this.labelBackgroundGraphicsContext}),M.DataLabelRenderer.drawLabelLeaderLines(this.labelGraphicsContext,p)),e.hasHighlights?(n=(r=o.select(".slices").selectAll("path"+v.selector).data(s(e.dataPointsToDeprecate),l)).enter().insert("path").classed(v.class,!0).each(function(t){this._current=t}).merge(r),x.isSingleColor(e.dataPoints),a.isHighContrast||n.style("stroke-opacity",1).style("stroke-dasharray",function(t){return x.drawStrokeForDonutChart(t,g,t.data.highlightRatio)}),n.style("fill",function(t){return t.data.color}).style("fill-opacity",1).style("stroke",c).style("stroke-width",function(t){return 0===t.data.highlightRatio?0:t.data.strokeWidth}).transition().duration(t).attrTween("d",function(t){var e=d3.interpolate(this._current,t),a=d3.interpolate(u*x.OuterRadiusRatio,x.getHighlightRadius(g,t.data.highlightRatio));return this._current=e(0),function(t){return d.innerRadius(y).outerRadius(a(t))(e(t))}}),i=r.exit().transition().delay(t).duration(0).remove()):o.selectAll("path"+v.selector).transition().delay(t).duration(0).remove(),this.assignInteractions(f,n,e),this.tooltipsEnabled&&this.addTooltips(f,n),M.SVGUtil.flushAllD3TransitionsIfNeeded(this.options,f,f.exit(),n,i),this.mobileInteractiveLegend&&(this.addInteractiveLegendArrow(),this.interactivityState.interactiveLegend.drawLegend(this.data.dataPointsToDeprecate),p=this.interactivityState.lastChosenInteractiveSliceIndex||0,this.setInteractiveChosenSlice(p,t))},x.prototype.addTooltips=function(t,e){this.tooltipService.addTooltip(t,function(t){return t.data&&t.data.data.tooltipInfo},function(t){return t.data&&t.data.data.identity&&[t.data.data.identity]}),e&&this.tooltipService.addTooltip(e,function(t){return t.data&&t.data.data.tooltipInfo},function(t){return t.data&&t.data.data.identity&&[t.data.data.identity]})},x.drawDefaultShapes=function(t,e,a,i,r,n){var t=t.select(".slices").selectAll("path"+b.selector).data(e.dataPoints,function(t){return t.data.identity.getKey()}),o=n&&n.hasSelection(),s=jsCommon.BrowserUtils.isInternetExplorerOrEdge(),l=t.enter().insert("path").attr("class",b.class).merge(t);return x.isSingleColor(e.dataPoints),n&&l.attr("tabindex",function(t){return null!=t.data.measure?0:null}).attr("focusable",function(t){return null!=t.data.measure||null}).attr("aria-label",function(t){return t.data.formattedTooltip}).attr("role","option").classed(M.SetFocusRingClassName,!s),l.style("fill",function(t){return t.data.color}).style("fill-opacity",function(t){return M.ColumnUtil.getFillOpacity(t.data.selected,!1,o,e.hasHighlights)}).style("stroke-opacity",function(t){return M.ColumnUtil.getFillOpacity(t.data.selected,!1,o,e.hasHighlights)}).style("stroke",e.borderColor).style("stroke-width",function(t){return t.data.strokeWidth}).attrs(a.shapeLayout.attrs).styles(a.shapeLayout.styles),t.exit().remove(),l},x.drawDefaultHighlightShapes=function(t,e,a,i,r){var t=t.select(".slices").selectAll("path"+v.selector).data(e.dataPoints.filter(function(t){return null!=t.data.highlightRatio}),function(t){return t.data.identity.getKey()}),n=t.enter().insert("path").classed(v.class,!0).each(function(t){this._current=t}).merge(t);return x.isSingleColor(e.dataPoints),n.style("fill",function(t){return t.data.color}).style("fill-opacity",function(t){return M.ColumnUtil.getFillOpacity(t.data.selected,!0,!1,e.hasHighlights)}).style("stroke-opacity",function(t){return M.ColumnUtil.getFillOpacity(t.data.selected,!0,!1,e.hasHighlights)}).style("stroke",M.ColorHelper.getThemeColor(r,M.DefaultDonutStrokeColorName)).style("stroke-width",function(t){return 0===t.data.highlightRatio?0:t.data.strokeWidth}).attrs(a.highlightShapeLayout.attrs).styles(a.highlightShapeLayout.styles),t.exit().remove(),n},x.isSingleColor=function(t){var e;1<t.length&&(t[e=t.length-1].data.isLastInDonut=t[e].data.color===t[0].data.color)},x.drawStrokeForDonutChart=function(t,e,a){var i,a=e.outerRadius*(a=void 0===a?1:a),r=(t.endAngle-t.startAngle)*a,n=e.innerRadius;if(0<n){var e=e.outerRadius-n,o=(t.endAngle-t.startAngle)*n;if(t.data.highlightRatio&&(r=(t.endAngle-t.startAngle)*(e+n)),t.data.isLastInDonut)return"0 "+r+" "+e+" "+o+" "+e;o=r+e+o,i=e}else i=t.data.isLastInDonut?(o=r,2*a):(o=r+a,a);return"0 "+o+" "+i},x.prototype.onClearSelection=function(){this.interactivityService&&this.interactivityService.clearSelection()},x.prototype.onRestoreSelection=function(t){return!!this.interactivityService&&this.interactivityService.restoreSelection(t.selection)},x.getLayout=function(s,t,e,a){var i=s.innerRadius,l=s.outerRadius,r=i||x.EffectiveZeroValue,d=d3.arc().innerRadius(i),n=d3.arc().innerRadius(i).outerRadius(l-a.explode),o=d3.arc().innerRadius(i).outerRadius(r);return{shapeLayout:{attrs:{d:function(t){return n(t)},transform:function(t){return e.pieChartMarginBetweenSlices?(t=(t.startAngle+t.endAngle)/2,"translate("+x.explodeXOffset(t,s)+", "+x.explodeYOffset(t,s)+")"):"translate(0, 0)"}},styles:{"stroke-dasharray":e.pieChartMarginBetweenSlices||t.isHighContrast?void 0:function(t){return x.drawStrokeForDonutChart(t,s)}}},highlightShapeLayout:{attrs:{d:function(t){return d.outerRadius(x.getHighlightRadius(s,t.data.highlightRatio))(t)}},styles:{"stroke-dasharray":t.isHighContrast?void 0:function(t){return x.drawStrokeForDonutChart(t,s,t.data.highlightRatio)}}},highlightShapeTween:function(o){return function(t){var e=0===o?l:x.getHighlightRadius(s,null!=(e=null==(e=this._current.data)?void 0:e.highlightRatio)?e:1),a=2===o?l:x.getHighlightRadius(s,t.data.highlightRatio),i=d.outerRadius(l),r=d3.interpolateNumber(e,a),n=d3.interpolate(this._current,t);return this._current=n(0),function(t){return i.outerRadius(r(t))(n(t)).toString()}}},zeroShapeLayout:{attrs:{d:function(t){return o(t)}},styles:{"stroke-dasharray":t.isHighContrast?void 0:function(t){return x.drawStrokeForDonutChart(t,s,r)}}}}},x.getHighlightRadius=function(t,e){var a=t.innerRadius;return a+e*(t.outerRadius-a)},x.cullDataByViewport=function(t,e,a,i,r,n){for(var o,s=0,l=(72<t.length&&(s=1/(Math.min(a.width,a.height)/2*c)*e),[]),d=0,h=t;d<h.length;d++){var u=h[d];u.measure>s&&(r=r===x.DefaultBorderWidth?i||o===u.color?1:0:r,u.strokeWidth=null!=n&&n.pieChartMarginBetweenSlices?r:i||o===u.color?1:0,o=u.color,l.push(u))}return l},x.getDefaultLabelSettings=function(t){var e=M.DataLabelViewModel.getDefaultLabelSettings({style:t,textClassName:"smallLightLabel",noColor:!0}).fontProperties;return{show:!0,position:0,displayUnits:0,precision:M.DataLabelViewModel.defaultLabelPrecision,fontProperties:e,enableBackground:!0,backgroundColor:M.ColorHelper.getThemeColor(t,M.DataLabelViewModel.DefaultLabelBackgroundColorName),backgroundTransparency:.5}},x.OuterRadiusRatio=.8,x.DefaultDonutInnerRadiusRatio=.48,x.DefaultStartAngleDegrees=0,x.OnePiRadianInDegree=180,x.DefaultExplode=0,x.DefaultBorderWidth=0,x.MinDonutThickness=5,x.InteractiveLegendContainerHeight=70,x.EffectiveZeroValue=1e-9,x.PolylineOpacity=.5,x);function x(t){t&&(this.isDonutChart=0!==t.sliceWidthRatio,this.animator=t.animator,this.isScrollable=t.isScrollable||!1,this.disableGeometricCulling=t.disableGeometricCulling||!1,this.behavior=t.behavior,this.tooltipsEnabled=t.tooltipsEnabled,t.smallViewPortProperties&&(this.maxHeightToScaleDonutLegend=t.smallViewPortProperties.maxHeightToScaleDonutLegend))}M.DonutChart=V,p.prototype.drawLegend=function(t){function e(t,e){function a(t){return 0<d-t?(d-t)/2:0}t.attr("data-legend-index",e.index).css({position:"absolute",left:u});var i=M.valueFormatter.format(e.label),r=M.valueFormatter.format(e.originalMeasure,e.measureFormat),n=M.valueFormatter.format(e.percentage,"0.00 %;-0.00 %;0.00 %"),e=e.color,r=p.createBasicLegendItemSpan(p.LegendItemValueClassName,r,11),i=p.createBasicLegendItemSpan(p.LegendItemCategoryClassName,i,11),n=p.createBasicLegendItemSpan(p.LegendItemPercentageClassName,n,20),o=p.spanWidth(r),s=p.spanWidth(i),l=p.spanWidth(n),d=p.legendBoxSize(o,s,l),o=(t.css("width",d),h.maxLegendItemWidth=Math.max(h.maxLegendItemWidth,d),a(o)),s=a(s),l=a(l);p.createLegendItemSpan(i,s),p.createLegendItemSpan(r,o),p.createLegendItemSpan(n,l).css("color",e),t.append(i),t.append(n),t.append(r),h.legendItemsPositions.push({startX:u,boxWidth:d}),u+=d+p.ItemMargin}var h=this,t=(this.data=t,this.currentNumberOfLegendItems=t.length,this.currentIndex=0,this.leftMostIndex=0,this.rightMostIndex=t.length-1,this.legendContainerParent.select(p.LegendContainerSelector).empty()&&(this.legendContainer=this.legendContainerParent.append("div").classed(p.LegendContainerClassName,!0)),this.legendContainer.selectAll(p.LegendItemSelector).data(t)),a=this.legendContainerWidth=this.legendContainer.node().getBoundingClientRect().width,a=a/2-.4*a/2+p.ItemMargin,u=a;this.currentXOffset=a;t.enter().insert("div").classed(p.LegendItemClassName,!0).each(function(t){e($(this),t)}),t.exit().remove(),this.assignInteractions()},p.prototype.updateLegend=function(t){var i=this,e=this.legendContainerWidth,r=(this.currentIndex=t,this.updateLabelBlocks(t),-1*(this.legendItemsPositions[t].startX+this.legendItemsPositions[t].boxWidth/2-e/2));this.legendContainer.transition().styleTween("-webkit-transform",function(t,e,a){return d3.interpolate(M.SVGUtil.translateWithPixels(i.currentXOffset,0),M.SVGUtil.translateWithPixels(r,0))}).styleTween("transform",function(t,e,a){return d3.interpolate(M.SVGUtil.translateWithPixels(i.currentXOffset,0),M.SVGUtil.translateWithPixels(r,0))}).duration(o.animationDurationMs).ease(M.D3Helper.easeCompat(o.ease)).on("end",function(){i.currentXOffset=r}),M.SVGUtil.flushAllD3TransitionsIfNeeded(this.visualInitOptions,this.legendContainer)},p.prototype.assignInteractions=function(){var e=this,a=0,t=d3.drag().on("start",function(){a=0}).on("drag",function(){var t;a+=d3.event.dx,Math.abs(a)<e.maxLegendItemWidth||(t=a<0,e.dragLegend(t),a=0)});this.legendContainer.style("touch-action","none").style("cursor","pointer").call(t)},p.prototype.dragLegend=function(t){this.currentNumberOfLegendItems>p.MinimumItemsInLegendForCycled-1?this.currentIndex=this.getCyclingCurrentIndex(t):this.shouldChangeIndexInNonCycling(t)&&(t?this.currentIndex++:this.currentIndex--),this.donutChart.setInteractiveChosenSlice(this.currentIndex)},p.prototype.shouldChangeIndexInNonCycling=function(t){return!(0===this.currentIndex&&!t||this.currentIndex===this.currentNumberOfLegendItems-1&&t)},p.prototype.getCyclingCurrentIndex=function(t){var e=this.data.length,t=(this.currentIndex+(t?1:-1))%(e||1);return t<0?t+e:t},p.prototype.updateLegendItemsBlocks=function(t,e){var a,i,r=$(this.legendContainer.node());t?((a=r.find("[data-legend-index="+this.leftMostIndex+"]")).remove().insertAfter(r.find("[data-legend-index="+this.rightMostIndex+"]")),i=this.legendItemsPositions[this.rightMostIndex].startX+this.legendItemsPositions[this.rightMostIndex].boxWidth+p.ItemMargin,this.legendItemsPositions[this.leftMostIndex].startX=i,a.css("left",i),this.rightMostIndex=this.leftMostIndex,this.leftMostIndex=(this.leftMostIndex+1)%this.data.length):((a=r.find("[data-legend-index="+this.rightMostIndex+"]")).remove().insertBefore(r.find("[data-legend-index="+this.leftMostIndex+"]")),i=this.legendItemsPositions[this.leftMostIndex].startX-this.legendItemsPositions[this.rightMostIndex].boxWidth-p.ItemMargin,this.legendItemsPositions[this.rightMostIndex].startX=i,a.css("left",i),this.leftMostIndex=this.rightMostIndex,this.rightMostIndex=this.rightMostIndex-1==-1?this.legendItemsPositions.length-1:this.rightMostIndex-1),e-1!=0&&this.updateLegendItemsBlocks(t,e-1)},p.prototype.updateLabelBlocks=function(t){this.currentNumberOfLegendItems>p.MinimumItemsInLegendForCycled?(this.rightMostIndex===t&&this.updateLegendItemsBlocks(!0,2),this.leftMostIndex===t&&this.updateLegendItemsBlocks(!1,2),(this.rightMostIndex===t+1||0===this.rightMostIndex&&t===this.currentNumberOfLegendItems-1)&&this.updateLegendItemsBlocks(!0,1),(this.leftMostIndex===t-1||this.leftMostIndex===this.currentNumberOfLegendItems-1&&0===t)&&this.updateLegendItemsBlocks(!1,1)):this.currentNumberOfLegendItems===p.MinimumItemsInLegendForCycled&&(this.rightMostIndex===t&&this.updateLegendItemsBlocks(!0,1),this.leftMostIndex===t&&this.updateLegendItemsBlocks(!1,1))},p.createBasicLegendItemSpan=function(t,e,a){return $("<span></span>").addClass(t).css({"white-space":"nowrap","font-size":a+"px"}).text(e)},p.createLegendItemSpan=function(t,e){return t.css({overflow:"hidden","text-overflow":"ellipsis",display:"inline-block",width:"100%","margin-left":e}),t},p.legendBoxSize=function(t,e,a){t=a<(t=e<t?t:e)?t:a;return t=p.MaxLegendItemBoxSize<t?p.MaxLegendItemBoxSize:t+2},p.spanWidth=function(t){return this.FakeElementSpan||(this.FakeElementSpan=$("<span>").hide().appendTo(document.body)),this.FakeElementSpan.empty(),this.FakeElementSpan.append(t),this.FakeElementSpan.width()},p.LegendContainerClassName="legend-container",p.LegendContainerSelector=".legend-container",p.LegendItemClassName="legend-item",p.LegendItemSelector=".legend-item",p.LegendItemCategoryClassName="category",p.LegendItemPercentageClassName="percentage",p.LegendItemValueClassName="value",p.MaxLegendItemBoxSize=160,p.ItemMargin=30,p.MinimumItemsInLegendForCycled=3;var d,i=p;function p(t,e,a,i){this.maxLegendItemWidth=15,this.legendContainerParent=e,this.donutChart=t,this.visualInitOptions=i,this.legendItemsPositions=[]}!function(t){function R(t,e,a,i){void 0===i&&(i=!0);var r=this.reader=g.data.createDataViewCategoricalReaderAdvanced(t,{staticSeriesRoleNames:["Y"],colorOptions:{valueRole:"Y",visualStyle:e},formatStringProp:M.donutChartProps.general.formatString}),n=r.data,o=(this.dataView=t).categorical,i=(this.dataViewMetadata=t.metadata,this.tooltipsEnabled=i,this.maxValue=0,this.hasNegativeValues=!1,this.allValuesAreNegative=!1,this.style=e,o.categories&&0<o.categories.length&&(t=o.categories[0],this.categoryValues=t.values,this.categoryFormatString=M.valueFormatter.getFormatString(t.source,M.donutChartProps.general.formatString)),this.hasDynamicSeries=r.columns.hasDynamicSeries(),this.hasSeriesData=n.hasSeries(),this.hasCategoryData=n.hasCategories(),this.highlightsOverflow=!1,this.total=0,this.highlightTotal=0,this.dataPoints=[],this.dataLabelsSettings=null,0),o=M.ColorHelper.create(e);if(this.borderColor=o.getColorForProperty(r.objects.getStaticObjects(),M.donutChartProps.slices.borderColor,M.DefaultDonutStrokeColorName),this.explode=g.DataViewObjects.getValue(r.objects.getStaticObjects(),M.donutChartProps.slices.explode,V.DefaultExplode),this.borderWidth=g.DataViewObjects.getValue(r.objects.getStaticObjects(),M.donutChartProps.slices.borderWidth,V.DefaultBorderWidth),null==(i=g.DataViewObjects.getValue(r.objects.getStaticObjects(),M.donutChartProps.slices.innerRadiusRatio))?i=a?V.DefaultDonutInnerRadiusRatio:0:i/=100/V.OuterRadiusRatio,this.startAngle=g.DataViewObjects.getValue(r.objects.getStaticObjects(),M.donutChartProps.slices.startAngle,V.DefaultStartAngleDegrees),this.donutInnerRadiusRatio=i,n.hasValues("Y")){var s=this.seriesCount=n.getSeriesCount(),l=(this.hasHighlights=n.hasHighlights(),n.getCategoryCount()||1);this.allValuesAreNegative=void 0;for(var d=0;d<l;d++)for(var h=0;h<s;h++){var u=n.getValue("Y",d,h),c=void 0;this.hasHighlights&&null==(c=n.getHighlight("Y",d,h))&&(c=0),void 0===this.allValuesAreNegative?this.allValuesAreNegative=(!this.hasHighlights||c<=0)&&u<=0:this.allValuesAreNegative=this.allValuesAreNegative&&(!this.hasHighlights||c<=0)&&u<=0,this.hasNegativeValues||(this.hasNegativeValues=u<0||!!this.hasHighlights&&c<0)}this.allValuesAreNegative=!!this.allValuesAreNegative;for(d=0;d<l;d++)for(h=0;h<s;h++){u=n.getValue("Y",d,h);u=R.normalizedValue(u,this.allValuesAreNegative),this.total+=u,this.hasHighlights&&(c=n.getHighlight("Y",d,h),c=R.normalizedValue(c,this.allValuesAreNegative),this.highlightTotal+=c,!this.highlightsOverflow&&g.Double.greaterWithPrecision(c,u,g.Double.getPrecision(Math.min(c,u)))&&(this.highlightsOverflow=!0))}}}R.normalizedValue=function(t,e){return null==t||isNaN(t)?0:t===Number.POSITIVE_INFINITY?Number.MAX_VALUE:t===Number.NEGATIVE_INFINITY?-Number.MAX_VALUE:e?Math.abs(t):t<0?0:t},R.prototype.convert=function(){var t=this.reader,e=this.reader.data,a=0!==this.total?this.categoryValues?this.convertCategoricalWithSlicing():this.hasDynamicSeries?this.convertSeries():this.convertMeasures():[];this.dataLabelsSettings=this.convertDataLabelSettings();for(var i=this.dataViewMetadata,r=(!i||(i=i.objects)&&(this.legendObjectProperties=i.legend),_.isEmpty(this.dataView.categorical.categories)?null:this.dataView.categorical.categories[0]),n=(this.dataPoints=[],M.donutChartProps.general.formatString),o=M.valueFormatter.getLocalizedString("Percentage"),s=null!=(i=this.dataLabelsSettings.fontProperties.color)?i:M.ColorHelper.getThemeColor(this.style,M.DataLabelViewModel.DefaultLabelColorName),l=null!=(i=this.dataLabelsSettings.fontProperties.color)?i:M.ColorHelper.getThemeColor(this.style,M.DataLabelViewModel.DefaultInsideLabelColorName),d=0,h=a.length;d<h;d++){var u=a[d],c=u.measure,g=R.normalizedValue(u.measure,this.allValuesAreNegative),p=u.highlightMeasure,f=R.normalizedValue(u.highlightMeasure,this.allValuesAreNegative),y=0<this.total?g/this.total:0,b=void 0,v=void 0,m=(g>this.maxValue&&(this.maxValue=g),f>this.maxValue&&(this.maxValue=f),this.hasHighlights&&(b=this.highlightsOverflow?(c=p,g=f,y=0<this.highlightTotal?f/this.highlightTotal:0,1):0!==g?f/g:0,v=y*(b=b||V.EffectiveZeroValue)),u.categoryLabel),S=this.dataView.categorical,L=void 0,L=null!=u.seriesIndex?u.seriesIndex:d,L=t.columns.getValueMetadataColumn("Y",L),C=this.hasHighlights&&this.highlightsOverflow?p:c,D=u.measureFormat||M.valueFormatter.getFormatString(L,n),w=this.hasHighlights&&!this.highlightsOverflow?p:void 0,x=u.highlightMeasureFormat||M.valueFormatter.getFormatString(L,n),P=M.valueFormatter.format(y,o),I=void 0,C=(null!=C&&null!=P&&(I=M.valueFormatter.format(C,D)+" ("+P+")"),void 0),P=(null!=w&&null!=v&&(D=M.valueFormatter.format(v,o),C=M.valueFormatter.format(w,x)+" ("+D+")"),void 0),w=(this.tooltipsEnabled&&(P=[],r&&P.push({displayName:r.source.displayName,value:m}),!this.hasDynamicSeries||r&&r.source===S.values.source||P.push({displayName:S.values.source.displayName,value:u.label}),null!=I&&P.push({displayName:L.displayName,value:I}),null!=C&&P.push({displayName:M.ToolTipComponent.localizationOptions.highlightedValueDisplayName,value:C}),M.TooltipBuilder.addTooltipMeasures(t,P,this.categoryValues?u.categoryIndex:0,this.hasDynamicSeries?u.seriesIndex:void 0,n)),this.style.isHighContrast||A===u.color&&y&&0<y?1:0),A=y&&0<y?u.color:A,x=M.DataLabelUtil.determineDataLabelFillColor({defaultColor:s,categoricalDataReader:t,categoryIndex:u.categoryIndex,seriesIndex:u.seriesIndex}),D=M.DataLabelUtil.determineDataLabelFillColor({defaultColor:l,categoricalDataReader:t,categoryIndex:u.categoryIndex,seriesIndex:u.seriesIndex}),m=M.DataLabelUtil.isAssignedColor(x)?x.color:void 0,C=(m&&(this.dataLabelsSettings.fontProperties=M.DataLabelUtil.updateFontPropertiesColor(m,this.dataLabelsSettings.fontProperties)),{identity:u.identity,measure:g,originalMeasure:c,measureFormat:null!=(S=u.measureFormat)?S:L.format,percentage:y,index:u.index,label:u.label,highlightRatio:b,highlightValue:this.hasHighlights&&!this.highlightsOverflow?f:void 0,originalHighlightValue:this.hasHighlights&&!this.highlightsOverflow?p:void 0,highlightFormat:this.hasHighlights&&!this.highlightsOverflow?null!=(I=u.highlightMeasureFormat)?I:L.format:void 0,highlightPercentage:this.hasHighlights&&!this.highlightsOverflow?v:void 0,selected:!1,tooltipInfo:P,formattedTooltip:M.tooltipUtils.formatTooltipInfo(P),color:u.color,strokeWidth:w,seriesIndex:u.seriesIndex||0,categoryIndex:u.categoryIndex||0});x.color&&(C.detailLabelFill=x.color),D.color&&(C.insideDetailLabelFill=D.color),this.dataPoints.push(C)}e.hasCategoryWithRole("Category")?this.legendData=M.Legend.buildCategoryLegendData({dataView:this.dataView,categoryRole:"Category",style:this.style,valueRole:"Y",showByDefault:!1}):this.legendData=M.Legend.buildSeriesLegendData({dataView:this.dataView,staticSeriesRoleNames:["Y"],style:this.style,showByDefault:!1})},R.prototype.convertCategoricalWithSlicing=function(){for(var t=this.reader,e=this.reader.data,a=this.dataView.categorical,i=M.donutChartProps.general.formatString,r=[],n=0,o=this.categoryValues.length;n<o;n++)for(var s=this.categoryValues[n],l=t.colors.createByCategory(n),d=M.valueFormatter.format(s,this.categoryFormatString),h=0;h<this.seriesCount;h++){var u,c,g,p,f,y=e.getValue("Y",n,h),b=e.getFormatString("Y",n,h),v=this.hasHighlights?e.getHighlight("Y",n,h):void 0,m=this.hasHighlights?e.getHighlightFormatString("Y",n,h):void 0;null==y&&null==v||(u=t.columns.getValueColumn("Y",h),p=a.values.grouped()[h],c=d,(this.hasDynamicSeries||1<e.getSeriesCount())&&(c=M.converterHelper.getFormattedLegendLabel(u.source,a.values,i)),f=u.source.queryName,g=M.SelectionIdBuilder.builder().withCategory([a.categories[0]],n,null==(g=null==(g=a.categories[0])?void 0:g.source)?void 0:g.queryName,!0).withSeries(a.values,this.hasDynamicSeries?p:void 0,!0).withMeasure(f,u,n).createSelectionId(),p=M.valueFormatter.getFormatString(u.source,i,!0),f={identity:g,measureFormat:b||p,measure:y,highlightMeasureFormat:null!=m?m:p,highlightMeasure:v,index:r.length,label:c,categoryLabel:d,color:l,categoryIndex:n,seriesIndex:h},r.push(f))}return r},R.prototype.convertMeasures=function(){for(var t=this.reader,e=[],a=M.donutChartProps.general.formatString,i=0;i<this.seriesCount;i++){var r=t.data.getValue("Y",0,i),n=t.data.getFormatString("Y",0,i),o=this.hasHighlights?t.data.getHighlight("Y",0,i):void 0,s=this.hasHighlights?t.data.getHighlightFormatString("Y",0,i):void 0,l=t.columns.getValueColumn("Y",i),d=M.valueFormatter.getFormatString(l.source,a,!0),h=l.source.displayName,l=M.SelectionId.createWithMeasure(l.source.queryName),u=t.colors.createBySeries(i);e.push({identity:l,measureFormat:n||d,measure:r,highlightMeasure:o,highlightMeasureFormat:s||d,index:i,label:h,categoryLabel:h,color:u,categoryIndex:i,seriesIndex:null})}return e},R.prototype.convertSeries=function(){for(var t=this.reader,e=this.dataView.categorical,a=[],i=M.donutChartProps.general.formatString,r=0;r<this.seriesCount;r++){var n=t.data.getValue("Y",0,r),o=t.data.getFormatString("Y",0,r),s=this.hasHighlights?t.data.getHighlight("Y",0,r):void 0,l=this.hasHighlights?t.data.getHighlightFormatString("Y",0,r):void 0,d=t.columns.getValueColumn("Y",r),h=e.values.grouped()[r],u=M.valueFormatter.getFormatString(d.source,i,!0),c=M.converterHelper.getFormattedLegendLabel(d.source,e.values,i),h=(new M.SelectionIdBuilder).withSeries(e.values,h,!0).withMeasure(d.source.queryName,d,0).createSelectionId(),d=t.colors.createBySeries(r);a.push({identity:h,measureFormat:o||u,measure:n,highlightMeasure:s,highlightMeasureFormat:null!=l?l:u,index:r,label:c,categoryLabel:c,color:d,categoryIndex:0,seriesIndex:r})}return a},R.prototype.convertDataLabelSettings=function(){var t,e=this.dataViewMetadata,a=V.getDefaultDonutLabelSettings(this.style);return e&&((e=e.objects)&&(t=e.labels)&&M.DataLabelViewModel.updateLabelSettingsFromLabelsObject(t,a,void 0,this.style),a.position=g.DataViewObjects.getValue(e,M.donutChartProps.labels.position,M.donutLabelPosition.outside),a.overflow=g.DataViewObjects.getValue(e,M.donutChartProps.labels.overflow,!0),a.enableBackgroundWithAuto=g.DataViewObjects.getValue(e,M.donutChartProps.labels.background,M.donutLabelBackground.auto)),a},t.DonutChartConverter=R}(d=d||{})}(powerbi=powerbi||{}),function(t){var o,e;function a(t){return e.call(this,t)||this}o=t.visuals||(t.visuals={}),e=o.BaseAnimator,__extends(a,e),a.prototype.animate=function(t){var e={failed:!0,shapes:null,highlightShapes:null},a=t.viewModel,i=this.previousViewModel;if(a.highlightsOverflow||i&&i.highlightsOverflow)return this.previousViewModel=a,e;var r=i&&i.hasHighlights,n=a.hasHighlights;return i&&(n&&!r?e=this.animateNormalToHighlighted(t):n&&r?e=this.animateHighlightedToHighlighted(t):!n&&r&&(e=this.animateHighlightedToNormal(t))),this.previousViewModel=a,e},a.prototype.animateNormalToHighlighted=function(e){var t=this.animateDefaultShapes(e),a=e.graphicsContext.select(".slices").selectAll("path.slice-highlight").data(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio}),function(t){return t.data.identity.getKey()}),i=a.enter().insert("path").classed("slice-highlight",!0).each(function(t){this._current=t}).merge(a),r=(o.DonutChart.isSingleColor(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio})),e.interactivityService&&e.interactivityService.hasSelection());return i.style("fill",function(t){return t.data.color||e.colors.getNewColorScale().getColor(t.data.identity.getKey()).value}).style("fill-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!0,r,e.viewModel.hasHighlights)}).style("stroke",o.ColorHelper.getThemeColor(e.style,o.DefaultDonutStrokeColorName)).style("stroke-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!0,r,e.viewModel.hasHighlights)}).style("stroke-width",function(t){return t.data.strokeWidth}).attrs(e.layout.shapeLayout.attrs).styles(e.layout.shapeLayout.styles).transition().duration(this.animationDuration).attrTween("d",e.layout.highlightShapeTween(0)).styles(e.layout.highlightShapeLayout.styles),a.exit().remove(),o.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:e.labelGraphicsContext,backgroundContext:e.labelBackgroundContext,dataLabels:e.labels,hasTooltip:!0,numeric:!1,twoRows:!0}),o.DataLabelRenderer.drawLabelLeaderLines(e.labelGraphicsContext,e.labels),{failed:!1,shapes:t,highlightShapes:i}},a.prototype.animateHighlightedToHighlighted=function(t){var e=this.animateDefaultShapes(t),a=this.animateDefaultHighlightShapes(t);return o.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:t.labelGraphicsContext,backgroundContext:t.labelBackgroundContext,dataLabels:t.labels,hasTooltip:!0,numeric:!1,twoRows:!0}),o.DataLabelRenderer.drawLabelLeaderLines(t.labelGraphicsContext,t.labels),{failed:!1,shapes:e,highlightShapes:a}},a.prototype.animateHighlightedToNormal=function(e){var a=e.interactivityService&&e.interactivityService.hasSelection(),t=this.animationDuration,i=e.graphicsContext.select(".slices").selectAll("path.slice").data(e.viewModel.dataPoints,function(t){return t.data.identity.getKey()}),r=i.enter().insert("path").classed("slice",!0).each(function(t){this._current=t}).merge(i),i=(o.DonutChart.isSingleColor(e.viewModel.dataPoints),r.style("fill",function(t){return t.data.color||e.colors.getNewColorScale().getColor(t.data.identity.getKey()).value}).style("fill-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,t.data.selected,!t.data.selected)}).style("stroke",o.ColorHelper.getThemeColor(e.style,o.DefaultDonutStrokeColorName)).style("stroke-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,t.data.selected,!t.data.selected)}).style("stroke-width",function(t){return t.data.strokeWidth}).transition().duration(t).attrs(e.layout.shapeLayout.attrs).styles(e.layout.shapeLayout.styles).transition().duration(0).style("fill-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,a,!1)}).style("stroke-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,a,!1)}),i.exit().remove(),e.graphicsContext.select(".slices").selectAll("path.slice-highlight").data(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio}),function(t){return t.data.identity.getKey()})),n=i.enter().insert("path").classed("slice-highlight",!0).each(function(t){this._current=t}).merge(i);return o.DonutChart.isSingleColor(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio})),i.exit().style("fill",function(t){return t.data.color||e.colors.getNewColorScale().getColor(t.data.identity.getKey()).value}).style("fill-opacity",o.ColumnUtil.getFillOpacity(!1,!0,!1,!0)).style("stroke",o.ColorHelper.getThemeColor(e.style,o.DefaultDonutStrokeColorName)).style("stroke-opacity",o.ColumnUtil.getFillOpacity(!1,!0,!1,!0)).style("stroke-width",function(t){return t.data.strokeWidth}).transition().duration(t).attrTween("d",e.layout.highlightShapeTween(2)).styles((a?e.layout.zeroShapeLayout:e.layout.shapeLayout).styles).remove(),o.DataLabelRenderer.drawLabelsAndBackgrounds({labelContext:e.labelGraphicsContext,backgroundContext:e.labelBackgroundContext,dataLabels:e.labels,hasTooltip:!0,numeric:!1,twoRows:!0}),o.DataLabelRenderer.drawLabelLeaderLines(e.labelGraphicsContext,e.labels),{failed:!1,shapes:r,highlightShapes:n}},a.prototype.animateDefaultShapes=function(e){var t=e.graphicsContext.select(".slices").selectAll("path.slice").data(e.viewModel.dataPoints,function(t){return t.data.identity.getKey()}),a=t.enter().insert("path").classed("slice",!0).each(function(t){this._current=t}).merge(t);return o.DonutChart.isSingleColor(e.viewModel.dataPoints),a.style("fill",function(t){return t.data.color||e.colors.getNewColorScale().getColor(t.data.identity.getKey()).value}).style("fill-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,!1,e.viewModel.hasHighlights)}).style("stroke",o.ColorHelper.getThemeColor(e.style,o.DefaultDonutStrokeColorName)).style("stroke-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!1,!1,e.viewModel.hasHighlights)}).style("stroke-width",function(t){return t.data.strokeWidth}).transition().duration(this.animationDuration).attrs(e.layout.shapeLayout.attrs).styles(e.layout.shapeLayout.styles),t.exit().remove(),a},a.prototype.animateDefaultHighlightShapes=function(e){var t=e.graphicsContext.select(".slices").selectAll("path.slice-highlight").data(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio}),function(t){return t.data.identity.getKey()}),a=t.enter().insert("path").classed("slice-highlight",!0).each(function(t){this._current=t}).merge(t),i=(o.DonutChart.isSingleColor(e.viewModel.dataPoints.filter(function(t){return null!=t.data.highlightRatio})),e.interactivityService&&e.interactivityService.hasSelection());return a.style("fill",function(t){return t.data.color||e.colors.getNewColorScale().getColor(t.data.identity.getKey()).value}).style("fill-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!0,i,e.viewModel.hasHighlights)}).style("stroke",o.ColorHelper.getThemeColor(e.style,o.DefaultDonutStrokeColorName)).style("stroke-opacity",function(t){return o.ColumnUtil.getFillOpacity(t.data.selected,!0,i,e.viewModel.hasHighlights)}).style("stroke-width",function(t){return t.data.strokeWidth}).transition().duration(this.animationDuration).attrTween("d",e.layout.highlightShapeTween(1)).styles(e.layout.highlightShapeLayout.styles),t.exit().remove(),a},o.WebDonutChartAnimator=a}(powerbi=powerbi||{}),function(t){!function(r){var n=jsCommon.BrowserUtils;function t(){}t.prototype.bindEvents=function(t,e,a){this.root=t.root,this.slices=t.slices,this.highlightSlices=t.highlightSlices,this.hasHighlights=t.hasHighlights,this.visualInstanceId=t.visualInstanceId;var i,t=t.clearCatcher;r.InteractivityUtils.registerStandardInteractivityHandlers(this.slices,e),this.highlightSlices&&r.InteractivityUtils.registerStandardInteractivityHandlers(this.highlightSlices,e),a&&(i=a.dataPointNavigationManager,a=a.pointSourceKey,i.isEmpty(a)||(r.InteractivityUtils.registerClearCatcherShortcut(this.root,e),r.InteractivityUtils.appendUseElementForFocus(this.root,this.visualInstanceId,a),r.InteractivityUtils.registerEnterPlotAreaHandler(this.root,i,a),r.InteractivityUtils.registerDataPointNavigationHandler(this.slices,i,a))),t.on("click",function(){var t=d3.event;n.isCtrlOrMeta(t)||e.handleClearSelection()})},t.prototype.renderFocus=function(t){var e=r.CurrentFocusDataPointId+"-"+this.visualInstanceId;this.root.select("#"+e).attr("id",null),t&&(t.setAttribute("id",e),n.focus(t))},t.prototype.renderSelection=function(e){var a=this.hasHighlights;this.slices.style("fill-opacity",function(t){return r.ColumnUtil.getFillOpacity(t.data.selected,!1,e,a)}).style("stroke-opacity",function(t){return r.ColumnUtil.getFillOpacity(t.data.selected,!1,e,a)}).attr("aria-selected",function(t){return t.data.selected}),this.highlightSlices&&this.highlightSlices.style("fill-opacity",function(t){return r.ColumnUtil.getFillOpacity(t.data.selected,!0,e,a)}).style("stroke-opacity",function(t){return r.ColumnUtil.getFillOpacity(t.data.selected,!0,e,a)})},r.DonutChartWebBehavior=t}(t.visuals||(t.visuals={}))}(powerbi=powerbi||{}),function(v){var y=v.visuals.donutLabelBackground,p=v.visuals.donutLabelPosition,m=v.visuals.DonutLabelUtils,b=jsCommon.EnumExtensions,S=v.visuals.FontProperties,L=v.visuals.labelStyle,C=v.visuals.DataLabelViewModel,D=L.labelStyleFlagEnum,w=v.visuals.DonutChart,f=[L.categoryAndDataAndPercent,L.categoryAndData,L.categoryAndPercent,L.dataAndPercent],x=[0,1,2,3,4];function u(t){this.donutChartProperties=t,this.center={x:t.viewport.width/2,y:t.viewport.height/2},this.labelRadius=this.donutChartProperties.labelRadius;t=S.toTextProperties(t.dataLabelsSettings.fontProperties);this.additionalParenthesesWidth=v.TextMeasurementService.measureSvgTextWidth(t,"()"),this.additionalSpaceWidth=v.TextMeasurementService.measureSvgTextWidth(t," "),this.ellipsisWidth=v.TextMeasurementService.measureSvgTextWidth(t,"")}u.prototype.layout=function(t,e,a){for(var i=[],r=0,n=t;r<n.length;r++){var o=n[r];i.push({labelDataPoint:o,hasBeenRendered:!1,labelSize:o.textSize})}for(var s=[],l=[],d=this.donutChartProperties.viewport,h={labelDataPoints:i,maxNumberOfLabels:t.length},h=new v.LabelArrangeGrid([h],d),u=i.length-1;0<=u;u--)i[u].labelDataPoint.isPreferred&&(l=i.splice(u,1).concat(l));return 0<l.length&&(s=this.positionLabels(l,h,e,a)),0<t.length&&(d=this.positionLabels(i,h,e,a),s=s.concat(d)),_.filter(s,function(t){return t.isVisible})},u.prototype.positionLabels=function(o,s,i,a){function t(t){for(var e=0,a=o;e<a.length;e++){var i,r,n=a[e];n.hasBeenRendered||(i=t(n,s))&&(r=i.label)&&(i.overflows&&(h=!0),n.hasBeenRendered=!0,d.push(r))}}function e(){t(function(t,e){return{label:n.tryOutsidePositionForDonut(t,e,i,a),overflows:!0}})}function r(){t(function(t,e){var a;return _.includes(f,n.donutChartProperties.dataLabelsSettings.labelStyle)?(a=n.splitDonutDataPoint(t,n.donutChartProperties.dataLabelsSettings.labelStyle),n.tryInsidePositionForDonut(a,n.donutChartProperties,e,i)):n.tryInsidePositionForDonut(t,n.donutChartProperties,e,i)})}var n=this,l=null==i.position?p.outside:i.position,d=[],h=!1;switch(l){case p.outside:e();break;case p.inside:r();break;case p.preferOutside:e(),r();break;case p.preferInside:r(),e()}if(h&&i.enableBackgroundWithAuto===y.auto)for(var u=0,c=d;u<c.length;u++){var g=c[u];g.outside||(g.hasBackground=!0)}return d},u.prototype.tryOutsidePositionForDonut=function(t,e,a,i){var r=t.labelDataPoint.parentShape;if(!_.isEmpty(r.validPositions)&&0!==r.validPositions[0]){var r=r.validPositions[0],n=this.tryAllOutsidePositions(t,e,r,i);if(n&&0===n.score)return this.buildLabel(n,e,!0,a);if(_.includes(f,this.donutChartProperties.dataLabelsSettings.labelStyle)){t=this.splitDonutDataPoint(t,this.donutChartProperties.dataLabelsSettings.labelStyle),t=this.tryAllOutsidePositions(t,e,r,i);if(t&&(!n||t.score<n.score))return this.buildLabel(t,e,!0,a)}return n?this.buildLabel(n,e,!0,a):void 0}},u.prototype.tryInsidePositionForDonut=function(t,e,a,i){t=this.tryAllInsidePositions(t,e,a,i.overflow);if(t)return{label:this.buildLabel(t,a,!1,i),overflows:t.overflows}},u.prototype.generateCandidate=function(t,e,a,i){var r=t.labelDataPoint,e=u.generateCandidateAngleForPosition(r.donutArcDescriptor,e),n=this.getPointPositionForAngle(e),o=n.point,s=this.score(r,o),l=(r.donutArcDescriptor.startAngle+r.donutArcDescriptor.endAngle)/2,d=w.explodeXOffset(l,this.donutChartProperties),l=w.explodeYOffset(l,this.donutChartProperties),o=m.getLabelLeaderLineForDonutChart(r.donutArcDescriptor,this.donutChartProperties,o,e,d,l,i),e=m.getLabelLeaderLinesSizeForDonutChart(o),d=_.clone(r);return d.parentShape=n,d.leaderLinePoints=o,d.linesSize=e,{point:n,score:s,labelRects:u.tryPositionPoint(a,n.validPositions[0],d,this.center,this.donutChartProperties.viewport,0,i),donutLabelDataPointLayoutInfo:{labelDataPoint:d,hasBeenRendered:t.hasBeenRendered,labelSize:t.labelSize},renderLeaderLines:!0,overflows:!1}},u.prototype.tryAllOutsidePositions=function(t,e,a,i){var r=t.labelDataPoint,n=this.donutChartProperties.explode,a=u.tryPositionPoint(e,a,r,this.center,this.donutChartProperties.viewport,n,i),n=r.parentShape,n={point:n,score:this.score(r,n.point),labelRects:a,donutLabelDataPointLayoutInfo:t,renderLeaderLines:!0,overflows:!1};if(a&&a.textRect&&0===n.score)return n;var o,s=[];a&&a.textRect?(s=u.getLabelPointPositions(r.parentShape,!0),o=n):s=u.getLabelPointPositions(r.parentShape,!1);for(var l=0,d=s;l<d.length;l++){var h=d[l],h=this.generateCandidate(t,h,e,i);if(h.labelRects&&h.labelRects.textRect&&(null==o||h.score<o.score)&&0===(o=h).score)return o}return o},u.prototype.tryAllInsidePositions=function(t,e,a,i){for(var r,n,o,s,l=t.labelDataPoint.angle,d=(e.innerRadius+e.outerRadius)/2,h=w.explodeXOffset(l,e),u=w.explodeYOffset(l,e),c=0,g=x;c<g.length;c++){var p=this.getInsidePosition(t,e,l,d,g[c]),f=this.score(t.labelDataPoint,p),p={point:p,radius:0,validPositions:[256]},y=v.DataLabelPointPositioner.getLabelRect(t.labelDataPoint.textSize,p,256,0),b=void 0,b=0===e.explode?{left:y.left+this.center.x,top:y.top+this.center.y,width:y.width,height:y.height}:{left:y.left+this.center.x+h,top:y.top+this.center.y+u,width:y.width,height:y.height},y=!m.canLabelFit(t.labelDataPoint.donutArcDescriptor,e,y);!(null==o||o<f)||a.hasConflict(b)||!i&&y||(r=p,n=b,o=f,s=y)}if(r)return{point:r,score:0,labelRects:{textRect:n,diagonalLineRect:null,horizontalLineRect:null},donutLabelDataPointLayoutInfo:t,renderLeaderLines:!1,overflows:s}},u.prototype.getInsidePosition=function(t,e,a,i,r){var n=i,o=a;switch(r){case 0:break;case 1:n=i+.25*(e.outerRadius-e.innerRadius);break;case 2:n=i-.25*(e.outerRadius-e.innerRadius);break;case 3:o=a+.25*(t.labelDataPoint.donutArcDescriptor.endAngle-t.labelDataPoint.donutArcDescriptor.startAngle);break;case 4:o=a-.25*(t.labelDataPoint.donutArcDescriptor.endAngle-t.labelDataPoint.donutArcDescriptor.startAngle)}return m.getLabelPosition(o,n)},u.prototype.buildLabel=function(t,e,a,i){var r,n,o=t.labelRects.textRect,s=t.labelRects.horizontalLineRect,l=t.labelRects.diagonalLineRect,d=t.donutLabelDataPointLayoutInfo.labelDataPoint,s=(null==d.categoryLabel&&null==d.dataLabel&&null==d.percentLabel||(r=!0),e.add(o),s&&e.add(s),l&&e.add(l),o.top-this.center.y),e=o.left-this.center.x;switch(a&&(e<0?e+=o.width/2:e-=o.width/2),t.point.validPositions[0]){case 8:n="start";break;case 4:n="end";break;case 256:n="middle"}var h,u,c,g,l={left:e,top:s,height:o.height,width:o.width},e=C.getLabelStyleFlagType(this.donutChartProperties.dataLabelsSettings.labelStyle),s=m.getSpaceAvailableForDonutLabels(d.parentShape.point.x,this.donutChartProperties.viewport),p=s,o=v.visuals.DataLabelViewModel.getLabelTailoredText;if(e===L.labelStyleFlagEnum.categoryAndDataAndPercent?null==d.secondRowText?p=s/=3:p/=2:e!==D.categoryAndData&&e!==D.categoryAndPercent&&e!==D.dataAndPercent||null==d.secondRowText&&(p=s/=2),b.hasFlag(e,L.flagLabelStyleData)&&(f=void 0,(f=e!==L.labelStyleFlagEnum.categoryAndDataAndPercent&&e!==D.categoryAndData||null!=d.secondRowText?p:p-this.additionalSpaceWidth)<this.ellipsisWidth&&(r=!1),h=o({label:d.dataLabel,maxWidth:f,fontProperties:d.fontProperties})),b.hasFlag(e,L.flagLabelStyleCategory)&&(s<this.ellipsisWidth&&(r=!1),u=o({label:d.categoryLabel,maxWidth:s,fontProperties:d.fontProperties})),b.hasFlag(e,L.flagLabelStylePercent)){var f=void 0;switch(e){case D.categoryAndDataAndPercent:f=p-this.additionalParenthesesWidth-this.additionalSpaceWidth;break;case D.dataAndPercent:f=null==d.secondRowText?p-this.additionalParenthesesWidth-this.additionalSpaceWidth:p-this.additionalParenthesesWidth;break;case D.categoryAndPercent:f=p-this.additionalSpaceWidth;break;default:D.percent;f=p}f<this.ellipsisWidth&&(r=!1),c=o({label:d.percentLabel,maxWidth:f,fontProperties:d.fontProperties})}switch(h&&""!==h||u&&""!==u||c&&""!==c||(r=!1),e){case D.categoryAndDataAndPercent:c=c?"("+c+")":null,null==d.secondRowText?g=C.combineStrings([u,h,c]," "):(g=C.combineStrings([h,c]," "),d.secondRowText=u);break;case D.categoryAndData:null==d.secondRowText?g=C.combineStrings([u,h]," "):(g=h,d.secondRowText=u);break;case D.categoryAndPercent:null==d.secondRowText?g=C.combineStrings([u,c]," "):(g=c,d.secondRowText=u);break;case D.dataAndPercent:c=c?"("+c+")":null,null==d.secondRowText?g=C.combineStrings([h,c]," "):(g=c,d.secondRowText=h);break;case D.data:g=h;break;case D.percent:g=c;break;default:D.category;g=u}return o=e===D.categoryAndDataAndPercent&&null==d.secondRowText?s+p+p:e===D.categoryAndData||e===D.categoryAndPercent?s+p:e===D.dataAndPercent?p+p:s,d.textSize.width=Math.min(d.textSize.width,o),{boundingBox:l,text:g,tooltip:a?d.tooltip:null,isVisible:r,identity:d.identity,fontProperties:S.inherit(d.fontProperties,{color:a?d.outsideFill:d.insideFill}),selected:!1,textAnchor:n,leaderLinePoints:t.renderLeaderLines?d.leaderLinePoints:void 0,hasBackground:!a&&i.enableBackgroundWithAuto===y.on,secondRowText:d.secondRowText,backgroundColor:d.backgroundColor,backgroundTransparency:d.backgroundTransparency,outside:a}},u.tryPositionPoint=function(t,e,a,i,r,n,o){void 0===n&&(n=0);var s=a.parentShape,o=null==o||!o.pieChartMarginBetweenSlices||C.startingLabelOffset-n<C.startingLabelOffset?C.startingLabelOffset:C.startingLabelOffset-n,n=_.clone(a.textSize),r=(n.width=Math.min(n.width,m.getSpaceAvailableForDonutLabels(s.point.x,r)),v.DataLabelPointPositioner.getLabelRect(n,s,e,o)),n={point:{x:a.leaderLinePoints[0][0],y:(a.leaderLinePoints[0][1]<0?a.leaderLinePoints[1]:a.leaderLinePoints[0])[1]},radius:0,validPositions:null},s=v.DataLabelPointPositioner.getLabelRect(a.linesSize[m.DiagonalLineIndex],n,e,o),n={point:{x:a.leaderLinePoints[1][0],y:a.leaderLinePoints[1][1]},radius:0,validPositions:null},a=v.DataLabelPointPositioner.getLabelRect(a.linesSize[m.HorizontalLineIndex],n,e,o);if(r&&s&&a)return r.left+=i.x,r.top+=i.y,n=i.x-r.width/2,s.left+=n,s.top+=i.y,a.left+=n,a.top+=i.y,t.hasConflict(r)||t.hasConflict(s)||t.hasConflict(a)?void 0:{textRect:r,diagonalLineRect:s,horizontalLineRect:a}},u.getLabelPointPositions=function(t,e){var a=t.validPositions[0];return e?t.point.y<0?8===a?[64]:[128]:8===a?[16]:[32]:4===a?[128,32]:[16,64]},u.prototype.splitDonutDataPoint=function(t,e){var a=t.labelDataPoint,i=a.categoryLabelSize?a.categoryLabelSize.width:0,r=a.dataLabelSize?a.dataLabelSize.width:0,n=a.percentLabelSize?e===L.dataAndPercent?a.percentLabelSize.width+this.additionalParenthesesWidth:e===L.categoryAndDataAndPercent?a.percentLabelSize.width+this.additionalParenthesesWidth+this.additionalSpaceWidth:a.percentLabelSize.width:0,o=a.categoryLabelSize?a.categoryLabelSize.height:0,s=a.dataLabelSize?a.dataLabelSize.height:0,l=a.percentLabelSize?a.percentLabelSize.height:0,i={width:e===L.dataAndPercent?Math.max(r,n):Math.max(i,r+n),height:2*Math.max(o,Math.max(s,l))},r=_.clone(a);return r.textSize=i,r.secondRowText=e===L.dataAndPercent?a.dataLabel:a.categoryLabel,{labelDataPoint:r,hasBeenRendered:t.hasBeenRendered,labelSize:t.labelSize}},u.generateCandidateAngleForPosition=function(t,e){var a=t.startAngle+(t.endAngle-t.startAngle)/2;switch(e){case 64:case 32:return(t.startAngle+a-Math.PI)/2;case 128:case 16:return(a+t.endAngle-Math.PI)/2}},u.prototype.getPointPositionForAngle=function(t){var e=m.getXPositionForDonutLabel(Math.cos(t)*this.labelRadius);return{point:{x:e,y:Math.sin(t)*this.labelRadius},validPositions:[e<0?4:8],radius:0}},u.prototype.score=function(t,e){var a,i,e=m.getSpaceAvailableForDonutLabels(e.x,this.donutChartProperties.viewport),r=this.donutChartProperties.dataLabelsSettings.labelStyle,n=t.categoryLabelSize?t.categoryLabelSize.width:0,o=t.dataLabelSize?t.dataLabelSize.width:0,s=t.percentLabelSize?t.percentLabelSize.width:0;if(r===L.categoryAndDataAndPercent){if(null!=t.secondRowText)return a=Math.max(n-e,0),i=Math.max(Math.max(o,s+this.additionalParenthesesWidth+this.additionalSpaceWidth)-e/2,0),Math.max(a,i);a=Math.max(n,o+this.additionalSpaceWidth,s+this.additionalParenthesesWidth+this.additionalSpaceWidth),e/=3}else r===L.categoryAndData&&null==t.secondRowText?(a=Math.max(n,o+this.additionalSpaceWidth),e/=2):r===L.categoryAndPercent&&null==t.secondRowText?(a=Math.max(n,s+this.additionalSpaceWidth),e/=2):r===L.dataAndPercent?(a=null==t.secondRowText?Math.max(o,s+this.additionalParenthesesWidth+this.additionalSpaceWidth):Math.max(o,s+this.additionalParenthesesWidth),e/=2):a=t.textSize.width;return Math.max(a-e,0)},v.DonutLabelLayout=u}(powerbi=powerbi||{}),function(t){((t=t.powerbi||(t.powerbi={})).visuals||(t.visuals={})).imporDonutChartModule=function(){}}(es6=es6||{}),function(t){var e;(e=t.visuals||(t.visuals={})).initializeDonutChartFactoryES6=function(){e.setCreateDonutChart(function(e){return es6.powerbi.visuals.imporDonutChartModule().then(function(t){return new t.DonutChart(e)})})}}(powerbi=powerbi||{});
this.parseTimeMarkers = this.parseTimeMarkers || {};
var marker = this.parseTimeMarkers['donutChartVisuals.min.js'] || (this.parseTimeMarkers['donutChartVisuals.min.js'] = {});
marker.endEval = window.jsCommon && window.jsCommon.performance && window.jsCommon.performance.now ? window.jsCommon.performance.now() : Date.now(); marker.isExternal = false;
